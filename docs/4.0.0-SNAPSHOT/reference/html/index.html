<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Spring Cloud Azure</title>
<link rel="stylesheet" href="css/spring.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
.hidden {
	display: none;
}

.switch {
	border-width: 1px 1px 0 1px;
	border-style: solid;
	border-color: #7a2518;
	display: inline-block;
}

.switch--item {
	padding: 10px;
	background-color: #ffffff;
	color: #7a2518;
	display: inline-block;
	cursor: pointer;
}

.switch--item:not(:first-child) {
	border-width: 0 0 0 1px;
	border-style: solid;
	border-color: #7a2518;
}

.switch--item.selected {
	background-color: #7a2519;
	color: #ffffff;
}

</style>
<script type="text/javascript">
function addBlockSwitches() {
	for (var primary of document.querySelectorAll('.primary')) {
		var switchItem = createSwitchItem(primary, createBlockSwitch(primary));
		switchItem.item.classList.add("selected");
		var title = primary.querySelector('.title')
		title.remove();
	}
	for (var secondary of document.querySelectorAll('.secondary')) {
		var primary = findPrimary(secondary);
		if (primary === null) {
			console.error("Found secondary block with no primary sibling");
		}
		else {
			var switchItem = createSwitchItem(secondary, primary.querySelector('.switch'));
			switchItem.content.classList.add("hidden");
			primary.append(switchItem.content);
			secondary.remove();
		}
	}
}

function createElementFromHtml(html) {
	var template = document.createElement('template');
    template.innerHTML = html;
    return template.content.firstChild;
}

function createBlockSwitch(primary) {
    var blockSwitch = createElementFromHtml('<div class="switch"></div>');
    primary.prepend(blockSwitch)
	return blockSwitch;
}

function findPrimary(secondary) {
	var candidate = secondary.previousElementSibling;
	while (candidate != null && !candidate.classList.contains('primary')) {
		candidate = candidate.previousElementSibling;
	}
	return candidate;
}

function createSwitchItem(block, blockSwitch) {
	var blockName = block.querySelector('.title').textContent;
	var content = block.querySelectorAll('.content').item(0);
	var colist = nextSibling(block, '.colist');
	if (colist != null) {
		content.append(colist);
	}
	var item = createElementFromHtml('<div class="switch--item">' + blockName + '</div>');
	item.dataset.blockName = blockName;
	content.dataset.blockName = blockName;
	blockSwitch.append(item);
	return {'item': item, 'content': content};
}

function nextSibling(element, selector) {
	var sibling = element.nextElementSibling;
	while (sibling) {
		if (sibling.matches(selector)) {
			return sibling;
		}
		sibling = sibling.nextElementSibling;
	}
}

function globalSwitch() {
	document.querySelectorAll(".switch--item").forEach(function(item) {
		var blockId = blockIdForSwitchItem(item);
		var handler = function(event) {
			selectedText = event.target.textContent;
			window.localStorage.setItem(blockId, selectedText);
			for (var switchItem of document.querySelectorAll(".switch--item")) {
				if (blockIdForSwitchItem(switchItem) === blockId && switchItem.textContent === selectedText) {
					select(switchItem);
				}
			}
		}
		item.addEventListener("click", handler);
		if (item.textContent === window.localStorage.getItem(blockId)) {
			select(item);
		}
	});
}

function select(selected) {
	for (var child of selected.parentNode.children) {
		child.classList.remove("selected");
	}
	selected.classList.add("selected");
	for (var child of selected.parentNode.parentNode.children) {
		if (child.classList.contains("content")) {
			if (selected.dataset.blockName === child.dataset.blockName) {
				child.classList.remove("hidden");
			}
			else {
				child.classList.add("hidden");
			}
		}
	}	
}

function blockIdForSwitchItem(item) {
	idComponents = []
	for (var switchItem of item.parentNode.querySelectorAll(".switch--item")) {
		idComponents.push(switchItem.textContent.toLowerCase());
	}
	return idComponents.sort().join("-")
}

window.onload = function() {
	addBlockSwitches();
	globalSwitch();
};

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Cloud Azure</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#what-is-new-in-4-0-since-3-10-x">1. What is New in 4.0 since 3.10.x</a>
<ul class="sectlevel2">
<li><a href="#unified-development-experience">1.1. Unified Development Experience</a></li>
<li><a href="#simplified-dependency-management">1.2. Simplified dependency management</a></li>
<li><a href="#expanded-support-scope-of-azure-support-on-start-spring-io">1.3. Expanded support scope of Azure Support on start.spring.io</a></li>
<li><a href="#untethered-and-unrestrained">1.4. Untethered and unrestrained</a></li>
<li><a href="#more-control-and-secure">1.5. More control and secure</a></li>
<li><a href="#more-options-exposed-in-a-spring-idiomatic-way">1.6. More options exposed in a Spring idiomatic way</a></li>
<li><a href="#more-production-ready">1.7. More Production Ready</a></li>
</ul>
</li>
<li><a href="#getting-started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#setting-up-dependencies">2.1. Setting up Dependencies</a></li>
<li><a href="#learning-spring-cloud-azure">2.2. Learning Spring Cloud Azure</a></li>
</ul>
</li>
<li><a href="#configuration">3. Configuration</a></li>
<li><a href="#authentication">4. Authentication</a>
<ul class="sectlevel2">
<li><a href="#authenticate-with-azure-active-directory">4.1. Authenticate with Azure Active Directory</a></li>
<li><a href="#managed-identity">4.2. Managed Identity</a></li>
<li><a href="#default-token-credential-chain">4.3. default token credential chain</a></li>
</ul>
</li>
<li><a href="#production-ready">5. Production Ready</a>
<ul class="sectlevel2">
<li><a href="#enable-health-indicator">5.1. Enable Health Indicator</a></li>
<li><a href="#enable-sleuth">5.2. Enable Sleuth</a></li>
<li><a href="#integrate-with-azure-monitor">5.3. Integrate with Azure Monitor</a></li>
</ul>
</li>
<li><a href="#auto-configure-azure-sdk-clients">6. Auto Configure Azure SDK Clients</a></li>
<li><a href="#resource-handling">7. Resource Handling</a>
<ul class="sectlevel2">
<li><a href="#dependency-setup">7.1. Dependency Setup</a></li>
<li><a href="#configuration-2">7.2. Configuration</a></li>
<li><a href="#basic-usage">7.3. Basic Usage</a></li>
<li><a href="#samples">7.4. Samples</a></li>
</ul>
</li>
<li><a href="#secret-management">8. Secret Management</a>
<ul class="sectlevel2">
<li><a href="#dependency-setup-2">8.1. Dependency Setup</a></li>
<li><a href="#configuration-3">8.2. Configuration</a></li>
<li><a href="#basic-usage-2">8.3. Basic Usage</a></li>
<li><a href="#samples-2">8.4. Samples</a></li>
</ul>
</li>
<li><a href="#spring-data-support">9. Spring Data Support</a>
<ul class="sectlevel2">
<li><a href="#cosmos-db">9.1. Cosmos DB</a></li>
<li><a href="#dependency-setup-3">9.2. Dependency Setup</a></li>
<li><a href="#configuration-4">9.3. Configuration</a></li>
<li><a href="#basic-usage-3">9.4. Basic Usage</a></li>
<li><a href="#samples-3">9.5. Samples</a></li>
</ul>
</li>
<li><a href="#spring-security-support">10. Spring Security Support</a>
<ul class="sectlevel2">
<li><a href="#spring-security-with-azure-ad">10.1. Spring Security with Azure AD</a></li>
<li><a href="#spring-security-with-azure-ad-b2c">10.2. Spring Security with Azure AD B2C</a></li>
</ul>
</li>
<li><a href="#spring-integration-support">11. Spring Integration Support</a>
<ul class="sectlevel2">
<li><a href="#spring-integration-with-azure-event-hubs">11.1. Spring Integration with Azure Event Hubs</a></li>
<li><a href="#spring-integration-with-azure-service-bus">11.2. Spring Integration with Azure Service Bus</a></li>
<li><a href="#spring-integration-with-azure-storage-queue">11.3. Spring Integration with Azure Storage Queue</a></li>
</ul>
</li>
<li><a href="#spring-cloud-stream-support">12. Spring Cloud Stream Support</a>
<ul class="sectlevel2">
<li><a href="#spring-cloud-stream-binder-for-azure-event-hubs">12.1. Spring Cloud Stream Binder for Azure Event Hubs</a></li>
<li><a href="#spring-cloud-stream-binder-for-azure-service-bus">12.2. Spring Cloud Stream Binder for Azure Service Bus</a></li>
</ul>
</li>
<li><a href="#kafka-support">13. Kafka Support</a>
<ul class="sectlevel2">
<li><a href="#dependency-setup-11">13.1. Dependency Setup</a></li>
<li><a href="#configuration-12">13.2. Configuration</a></li>
<li><a href="#basic-usage-11">13.3. Basic Usage</a></li>
<li><a href="#samples-11">13.4. Samples</a></li>
<li><a href="#troubleshooting">13.5. Troubleshooting</a></li>
<li><a href="#dependency-setup-12">13.6. Dependency Setup</a></li>
<li><a href="#configuration-13">13.7. Configuration</a></li>
<li><a href="#basic-usage-12">13.8. Basic Usage</a></li>
<li><a href="#samples-12">13.9. Samples</a></li>
</ul>
</li>
<li><a href="#resource-manager">14. Resource Manager</a>
<ul class="sectlevel2">
<li><a href="#dependency-setup-13">14.1. Dependency Setup</a></li>
<li><a href="#configuration-14">14.2. Configuration</a></li>
<li><a href="#basic-usage-13">14.3. Basic Usage</a></li>
<li><a href="#samples-13">14.4. Samples</a></li>
</ul>
</li>
<li><a href="#configuration-properties">15. Configuration Properties</a></li>
<li><a href="#migration-guide-for-4-0">16. Migration Guide for 4.0</a>
<ul class="sectlevel2">
<li><a href="#migration-benefits">16.1. Migration benefits</a></li>
<li><a href="#overview">16.2. Overview</a></li>
<li><a href="#naming-changes">16.3. Naming changes</a></li>
<li><a href="#bom">16.4. BOM</a></li>
<li><a href="#artifact-changes-renamed-added-deleted">16.5. Artifact changes: renamed / added / deleted</a></li>
<li><a href="#dependencies-changes">16.6. Dependencies changes</a></li>
<li><a href="#authentication-2">16.7. Authentication</a></li>
<li><a href="#configuration-properties-2">16.8. Configuration properties</a></li>
<li><a href="#api-breaking-changes">16.9. API breaking changes</a></li>
</ul>
</li>
<li><a href="#known-issues">17. Known Issues</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Azure offers a convenient way to interact with Azure provided services using well-known Spring idioms and APIs for Spring developers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring Cloud is released under the non-restrictive Apache 2.0 license. If you would like to contribute to this section of the documentation or if you find an error, please find the source code and issue trackers in the project at <a href="https://github.com/spring-cloud/spring-cloud-azure">github</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-is-new-in-4-0-since-3-10-x"><a class="anchor" href="#what-is-new-in-4-0-since-3-10-x"></a><a class="link" href="#what-is-new-in-4-0-since-3-10-x">1. What is New in 4.0 since 3.10.x</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers the changes made from version 3.10 to version 4.0.0-beta.1. With this major release, we aim to bring better security, leaner dependencies, support for production readiness, and more.</p>
</div>
<div class="sect2">
<h3 id="unified-development-experience"><a class="anchor" href="#unified-development-experience"></a><a class="link" href="#unified-development-experience">1.1. Unified Development Experience</a></h3>
<div class="paragraph">
<p>We constantly challenge ourselves on how we can make things more consistent and easier to understand, so our customers are not confronted with haphazard development choices. This is a long and self-evolving journey as consistency is relative and there will be things that are outside of our control. We now humbly take another step in this direction to improve to our developer experience by unifying project name, artifact ID and properties.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Example or screenshot</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="simplified-dependency-management"><a class="anchor" href="#simplified-dependency-management"></a><a class="link" href="#simplified-dependency-management">1.2. Simplified dependency management</a></h3>
<div class="paragraph">
<p>Dependency management is one of the core value pillars that has helped Spring establish preeminence over to other Java frameworks. In that spirit, we have also been exploring ways to make dependency management easier for Spring developers on Azure. In this release, we have codified best practices and expertise from Spring experts and condensed all of our dependency BOMs into one, <code>spring-cloud-azure-dependencies</code>, which we believe will further bring down the learning curve and avoid ill-handling of dependencies.</p>
</div>
</div>
<div class="sect2">
<h3 id="expanded-support-scope-of-azure-support-on-start-spring-io"><a class="anchor" href="#expanded-support-scope-of-azure-support-on-start-spring-io"></a><a class="link" href="#expanded-support-scope-of-azure-support-on-start-spring-io">1.3. Expanded support scope of Azure Support on <a href="https://start.spring.io" class="bare">start.spring.io</a></a></h3>
<div class="paragraph">
<p>The Azure Support module in <a href="https://start.spring.io">Spring Initializr</a> provides auto-configuration of many Azure services.</p>
</div>
<div class="paragraph">
<p>In this release we have expanded the scope of Azure Support to cover the additional 4 more services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka</p>
</li>
<li>
<p>Event Hubs</p>
</li>
<li>
<p>Azure Cache for Redis</p>
</li>
<li>
<p>App Configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Our journey does end here and over time we will bring even more Azure services into the fold.</p>
</div>
</div>
<div class="sect2">
<h3 id="untethered-and-unrestrained"><a class="anchor" href="#untethered-and-unrestrained"></a><a class="link" href="#untethered-and-unrestrained">1.4. Untethered and unrestrained</a></h3>
<div class="paragraph">
<p>One feedback that we consistently hear is our Spring modules are unnecessarily stacked on top of too many layers of dependencies, which has prevented broader adoption. As an example, all of our early Spring modules rely on Spring Boot, and many of our customers are running Spring MVC apps in Tomcat, leveraging nothing but Spring Data, as an example, to communicate with data services. We now realize the flaw in our original design, and have rearchitected our Spring module dependencies from the ground up, untethered from layers of excess and entanglement.</p>
</div>
</div>
<div class="sect2">
<h3 id="more-control-and-secure"><a class="anchor" href="#more-control-and-secure"></a><a class="link" href="#more-control-and-secure">1.5. More control and secure</a></h3>
<div class="paragraph">
<p>At the heart of every real-world application, is identity and secret management. Support for managed identity has become an Azure fundamental that are getting mandated as a security baseline at individual services. We believe aligning on those guidelines will also benefit Spring developers at large, and have added Managed Identity support for App Configuration, Event Hub, Service Bus, Cosmos, Key Vault, Storage Blob, and Storage Queue. This enables building credential-free applications, which is a pattern that has picked up tremendous momentum both at Microsoft and in the community. In addition to Managed Identity, you can use any authentication methods supported in the underlying Azure SDK from our Spring libraries. For instance, you use SAS token and token credential to authenticate with Service Bus and Event Hubs. <a href="https://docs.microsoft.com/en-us/java/api/overview/azure/identity-readme?view=azure-java-stable#defaultazurecredential">Credential chain</a> is now enabled by default, allowing applications to obtain credentials from application properties, environment variables, managed identity, IDEs, etc. Lastly providing granular level access control at the resource level (i.e.: Service Bus queue), is often of paramount importance when it comes to meeting the needs of our enterprise customers. We’ve now unlocked these controls to our customers for better security governance and adherence to IT policies.</p>
</div>
</div>
<div class="sect2">
<h3 id="more-options-exposed-in-a-spring-idiomatic-way"><a class="anchor" href="#more-options-exposed-in-a-spring-idiomatic-way"></a><a class="link" href="#more-options-exposed-in-a-spring-idiomatic-way">1.6. More options exposed in a Spring idiomatic way</a></h3>
<div class="paragraph">
<p>Spring developers have long enjoyed the convenience of defining client options in application configuration files. We certainly do not want to take that privilege away and burden Spring developers with setting options via client objects. To that end, we’ve significantly improved autoconfiguration coverage of Azure SDK clients for both synchronous and asynchronous scenarios.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Sample code</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="more-production-ready"><a class="anchor" href="#more-production-ready"></a><a class="link" href="#more-production-ready">1.7. More Production Ready</a></h3>
<div class="paragraph">
<p>Lastly all of the above would be in vain if we do not have enough feature coverage to support our customers in production. Many things come to my mind to make an application production-ready, but observability often arrives at the top. We’ve added health indicators for App Configuration, Event Hubs, Cosmos, Key Vault, Storage Blob, Storage Queue, Storage File, as well as Spring Cloud Sleuth support for all HTTP-based Azure SDKs. As an example, you now can prob if storage blob is up or down via Spring Boot actuator endpoint, as well as track dependencies and latencies going from your application to Cosmos DB.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a><a class="link" href="#getting-started">2. Getting Started</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="setting-up-dependencies"><a class="anchor" href="#setting-up-dependencies"></a><a class="link" href="#setting-up-dependencies">2.1. Setting up Dependencies</a></h3>
<div class="sect3">
<h4 id="bill-of-material-bom"><a class="anchor" href="#bill-of-material-bom"></a><a class="link" href="#bill-of-material-bom">2.1.1. Bill of Material (BOM)</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
      &lt;artifactId&gt;spring-cloud-azure-dependencies&lt;/artifactId&gt;
      &lt;version&gt;4.0.0-beta.1&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="starter-dependencies"><a class="anchor" href="#starter-dependencies"></a><a class="link" href="#starter-dependencies">2.1.2. Starter Dependencies</a></h4>
<div class="paragraph">
<p>Spring Cloud Azure Starters are a set of convenient dependency descriptors to include in your application. Each starter contains all the dependencies and transitive dependencies needed to begin using their corresponding Spring Cloud Azure module. It boosts your Spring Boot application development with Azure services.</p>
</div>
<div class="paragraph">
<p>For example, if you want to get started using Spring and Azure Cosmos DB for data persistence, include the <code>spring-cloud-azure-starter-cosmos</code> dependency in your project.</p>
</div>
<div class="paragraph">
<p>The following application starters are provided by Spring Cloud Azure under the <code>com.azure.spring</code> group:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core starter, including auto-configuration support</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-active-directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Active Directory with Spring Security</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-active-directory-b2c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Active Directory B2C with Spring Security</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-appconfiguration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure App Configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-cosmos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Cosmos DB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Event Hubs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-keyvault-secrets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Key Vault Secrets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Service Bus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-servicebus-jms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Service Bus and JMS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-storage-blob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Storage Blob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-storage-file-share</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Storage File Share</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-storage-queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Storage Queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-actuator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Spring Boot’s Actuator which provides production ready features</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Below are starters for <strong>Spring Data</strong> support:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-data-cosmos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Cosmos DB and Spring Data Cosmos DB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Below are starters for <strong>Spring Integration</strong> support:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-integration-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Event Hubs and Spring Integration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-integration-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Service Bus and Spring Integration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-integration-storage-queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Storage Queue and Spring Integration</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Below are starters for <strong>Spring Cloud Stream</strong> support:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-stream-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Event Hubs and Spring Cloud Stream Binder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-stream-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Service Bus and Spring Cloud Stream Binder</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="learning-spring-cloud-azure"><a class="anchor" href="#learning-spring-cloud-azure"></a><a class="link" href="#learning-spring-cloud-azure">2.2. Learning Spring Cloud Azure</a></h3>
<div class="paragraph">
<p><a href="https://github.com/Azure-Samples/azure-spring-boot-samples">Sample Applications</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a><a class="link" href="#configuration">3. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most of Azure Service SDKs could divide into two categories by transport type, HTTP-based and AMQP-based. There are properties that are common to all SDKs such as authentication principals and Azure environment settings. Or common to all HTTP-based clients, such as setting logging level to log http requests and responses. In Spring Cloud Azure 4.0 we added five common categories of configuration properties, which could be specified to each Azure service.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.<strong>&lt;azure-service&gt;</strong>.client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the transport clients underneath one Azure service SDK.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.<strong>&lt;azure-service&gt;</strong>.credential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure how to authenticate with Azure Active Directory for one Azure service SDK..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.<strong>&lt;azure-service&gt;</strong>.profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the Azure cloud environment one Azure service SDK.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.<strong>&lt;azure-service&gt;</strong>.proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the proxy options for one Azure service SDK.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.<strong>&lt;azure-service&gt;</strong>.retry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the retry options apply to one Azure service SDK.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are some properties that could be shared among different Azure services, for example using the same service principal to access Azure Cosmos DB and Azure Event Hubs. Spring Cloud Azure 4.0 allows developers to define properties that apply to all Azure SDKs in the namespace <code>spring.cloud.azure</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the transport clients apply to all Azure SDKs by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.credential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure how to authenticate with Azure Active Directory for all Azure SDKs by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the Azure cloud environment for all Azure SDKs by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the proxy options apply to all Azure SDK clients by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.retry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the retry options apply to all Azure SDK clients by default.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please note that properties configured under each Azure service will override the global configurations.</p>
</div>
<div class="paragraph">
<p>The configuration properties' prefixes have been unified to <code>spring.cloud.azure</code> namespace since Spring Cloud Azure 4.0, it will make configuration properties more consistent and configuring it in a more intuitive way. Here&#8217;s a quick review of the prefixes of supported Azure services.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Azure Service</th>
<th class="tableblock halign-left valign-top">Configuration Property Prefix</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure App Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.appconfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Cosmos DB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.cosmos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Event Hubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.eventhubs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Key Vault Certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.keyvault.certificate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Key Vault Secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.keyvault.secret</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Service Bus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.servicebus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Storage Blob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.blob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Storage File Share</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.fileshare</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Storage Queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.queue</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="authentication"><a class="anchor" href="#authentication"></a><a class="link" href="#authentication">4. Authentication</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="authenticate-with-azure-active-directory"><a class="anchor" href="#authenticate-with-azure-active-directory"></a><a class="link" href="#authenticate-with-azure-active-directory">4.1. Authenticate with Azure Active Directory</a></h3>

</div>
<div class="sect2">
<h3 id="managed-identity"><a class="anchor" href="#managed-identity"></a><a class="link" href="#managed-identity">4.2. Managed Identity</a></h3>
<div class="paragraph">
<p>We encourage using manged identity …</p>
</div>
<div class="paragraph">
<p>pattern</p>
</div>
</div>
<div class="sect2">
<h3 id="default-token-credential-chain"><a class="anchor" href="#default-token-credential-chain"></a><a class="link" href="#default-token-credential-chain">4.3. default token credential chain</a></h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>scary error logs</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="production-ready"><a class="anchor" href="#production-ready"></a><a class="link" href="#production-ready">5. Production Ready</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you choose to add Spring Cloud Azure Actuator, include actuator dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-azure-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="enable-health-indicator"><a class="anchor" href="#enable-health-indicator"></a><a class="link" href="#enable-health-indicator">5.1. Enable Health Indicator</a></h3>
<div class="paragraph">
<p>for Cosmos DB, add <code>management.health.azure-cosmos.enabled=true</code> to application.yaml.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">management.health.azure-cosmos.enabled: true</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Warning: Call <code><a href="http://{hostname}:{port}/actuator/health/cosmos" class="bare">{hostname}:{port}/actuator/health/cosmos</a></code> to get the Cosmos DB health info. <strong>Please note</strong>: it will calculate <a href="https://docs.microsoft.com/azure/cosmos-db/request-units">RUs</a>.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="enable-sleuth"><a class="anchor" href="#enable-sleuth"></a><a class="link" href="#enable-sleuth">5.2. Enable Sleuth</a></h3>

</div>
<div class="sect2">
<h3 id="integrate-with-azure-monitor"><a class="anchor" href="#integrate-with-azure-monitor"></a><a class="link" href="#integrate-with-azure-monitor">5.3. Integrate with Azure Monitor</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="auto-configure-azure-sdk-clients"><a class="anchor" href="#auto-configure-azure-sdk-clients"></a><a class="link" href="#auto-configure-azure-sdk-clients">6. Auto Configure Azure SDK Clients</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="resource-handling"><a class="anchor" href="#resource-handling"></a><a class="link" href="#resource-handling">7. Resource Handling</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dependency-setup"><a class="anchor" href="#dependency-setup"></a><a class="link" href="#dependency-setup">7.1. Dependency Setup</a></h3>

</div>
<div class="sect2">
<h3 id="configuration-2"><a class="anchor" href="#configuration-2"></a><a class="link" href="#configuration-2">7.2. Configuration</a></h3>
<div class="paragraph">
<p>for full configurations, check appendix</p>
</div>
</div>
<div class="sect2">
<h3 id="basic-usage"><a class="anchor" href="#basic-usage"></a><a class="link" href="#basic-usage">7.3. Basic Usage</a></h3>

</div>
<div class="sect2">
<h3 id="samples"><a class="anchor" href="#samples"></a><a class="link" href="#samples">7.4. Samples</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="secret-management"><a class="anchor" href="#secret-management"></a><a class="link" href="#secret-management">8. Secret Management</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>spring-cloud-azure-starter-keyvault-secrets adds Azure Key Vault as one of the Spring PropertySource, so secrets stored in Azure Key Vault could be easily used and conveniently accessed like other externalized configuration property, e.g. properties in files.</p>
</div>
<div class="sect2">
<h3 id="dependency-setup-2"><a class="anchor" href="#dependency-setup-2"></a><a class="link" href="#dependency-setup-2">8.1. Dependency Setup</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-azure-starter-keyvault-secrets&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-3"><a class="anchor" href="#configuration-3"></a><a class="link" href="#configuration-3">8.2. Configuration</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">spring:
  cloud:
    azure:
      tenant-id: put-your-tenant-id-here
      client-id: put-your-client-id-here
      client-key: put-your-client-key-here
      keyvault:
        secret:
          # TODO</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="basic-usage-2"><a class="anchor" href="#basic-usage-2"></a><a class="link" href="#basic-usage-2">8.3. Basic Usage</a></h3>

</div>
<div class="sect2">
<h3 id="samples-2"><a class="anchor" href="#samples-2"></a><a class="link" href="#samples-2">8.4. Samples</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SpringBootApplication
public class KeyVaultSample implements CommandLineRunner {

    @Value("${your-property-name}")
    private String mySecretProperty;

    public static void main(String[] args) {
        SpringApplication.run(KeyVaultSample.class, args);
    }

    @Override
    public void run(String... args) {
        System.out.println("property your-property-name value is: " + mySecretProperty);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-data-support"><a class="anchor" href="#spring-data-support"></a><a class="link" href="#spring-data-support">9. Spring Data Support</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cosmos-db"><a class="anchor" href="#cosmos-db"></a><a class="link" href="#cosmos-db">9.1. Cosmos DB</a></h3>
<div class="paragraph">
<p>brief introduction of the project</p>
</div>
</div>
<div class="sect2">
<h3 id="dependency-setup-3"><a class="anchor" href="#dependency-setup-3"></a><a class="link" href="#dependency-setup-3">9.2. Dependency Setup</a></h3>

</div>
<div class="sect2">
<h3 id="configuration-4"><a class="anchor" href="#configuration-4"></a><a class="link" href="#configuration-4">9.3. Configuration</a></h3>
<div class="paragraph">
<p>for full configurations, check appendix</p>
</div>
</div>
<div class="sect2">
<h3 id="basic-usage-3"><a class="anchor" href="#basic-usage-3"></a><a class="link" href="#basic-usage-3">9.4. Basic Usage</a></h3>

</div>
<div class="sect2">
<h3 id="samples-3"><a class="anchor" href="#samples-3"></a><a class="link" href="#samples-3">9.5. Samples</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-security-support"><a class="anchor" href="#spring-security-support"></a><a class="link" href="#spring-security-support">10. Spring Security Support</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="spring-security-with-azure-ad"><a class="anchor" href="#spring-security-with-azure-ad"></a><a class="link" href="#spring-security-with-azure-ad">10.1. Spring Security with Azure AD</a></h3>
<div class="sect3">
<h4 id="dependency-setup-4"><a class="anchor" href="#dependency-setup-4"></a><a class="link" href="#dependency-setup-4">10.1.1. Dependency Setup</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-azure-starter-active-directory&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-5"><a class="anchor" href="#configuration-5"></a><a class="link" href="#configuration-5">10.1.2. Configuration</a></h4>
<div class="paragraph">
<p>This starter provides the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Properties</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.app-id-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It used in resource server, used to validate the audience in access_token. access_token is valid only when the audience in access_token equal to client-id or app-id-uri</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.authorization-clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map configure the resource APIs the application is going to visit. Each item corresponding to one resource API the application is going to visit. In Spring code, each item corresponding to one OAuth2AuthorizedClient object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.authorization-clients.{client-name}.scopes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API permissions of a resource server that the application is going to acquire.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.authorization-clients.{client-name}.on-demand</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is used for incremental consent. The default value is false. If it&#8217;s true, it&#8217;s not consent when user login, when application needs the additional permission, incremental consent is performed with one OAuth2 authorization code flow.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.authorization-clients.{client-name}.authorization-grant-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of authorization client. Supported types are <a href="https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow">authorization_code</a> (default type for webapp), <a href="https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow">on_behalf_of</a> (default type for resource-server), <a href="https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow">client_credentials</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.application-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refer to <a href="property-example-1&.html#8212;&#8203;application-type">Application type</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.base-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base uri for authorization server, the default value is <code><a href="https://login.microsoftonline.com/" class="bare">login.microsoftonline.com/</a></code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registered application ID in Azure AD.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.client-secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">client secret of the registered application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.graph-membership-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It&#8217;s used to load users' groups. The default value is <code><a href="https://graph.microsoft.com/v1.0/me/memberOf" class="bare">graph.microsoft.com/v1.0/me/memberOf</a></code>, this uri just get direct groups. To get all transitive membership, set it to <code><a href="https://graph.microsoft.com/v1.0/me/transitiveMemberOf" class="bare">graph.microsoft.com/v1.0/me/transitiveMemberOf</a></code>. The 2 uris are both Azure Global, check <code>Property example 1</code> if you want to use Azure China.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.post-logout-redirect-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redirect uri for posting log-out.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.resource-server.principal-claim-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal claim name. Default value is "sub".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.resource-server.claim-to-authority-prefix-map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Claim to authority prefix map. Default map is: "scp" -&gt; "SCOPE_", "roles" -&gt; "APPROLE_".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.tenant-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Tenant ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.user-group.allowed-group-names</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users' group name can be use in <code>@PreAuthorize(&quot;hasRole(&#39;ROLE_group_name_1&#39;)&quot;)</code>. Not all group name will take effect, only group names configured in this property will take effect.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.user-group.allowed-group-ids</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users' group id can be use in <code>@PreAuthorize(&quot;hasRole(&#39;ROLE_group_id_1&#39;)&quot;)</code>. Not all group id will take effect, only group id configured in this property will take effect. If this property&#8217;s value is <code>all</code>, then all group id will take effect.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.active-directory</strong>.user-name-attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decide which claim to be principal&#8217;s name.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are some examples about how to use these properties:</p>
</div>
<div class="sect4">
<h5 id="property-example-1-application-type"><a class="anchor" href="#property-example-1-application-type"></a><a class="link" href="#property-example-1-application-type">Property example 1: Application type</a></h5>
<div class="paragraph">
<p>This property(<code>spring.cloud.azure.active-directory.application-type</code>) is optional, its value can be inferred by dependencies, only <code>web_application_and_resource_server</code> must be configured manually: <code>spring.cloud.azure.active-directory.application-type=web_application_and_resource_server</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Has dependency: spring-security-oauth2-client</th>
<th class="tableblock halign-left valign-top">Has dependency: spring-security-oauth2-resource-server</th>
<th class="tableblock halign-left valign-top">Valid values of application type</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>web_application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>web_application</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resource_server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resource_server</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>web_application</code>,<code>resource_server</code>,<code>resource_server_with_obo</code>, <code>web_application_and_resource_server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resource_server_with_obo</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="property-example-2-use-azure-china-instead-of-azure-global"><a class="anchor" href="#property-example-2-use-azure-china-instead-of-azure-global"></a><a class="link" href="#property-example-2-use-azure-china-instead-of-azure-global">Property example 2: Use <a href="https://docs.microsoft.com/azure/china/resources-developer-guide#check-endpoints-in-azure">Azure China</a> instead of Azure Global.</a></h5>
<div class="ulist">
<ul>
<li>
<p>Step 1: Add property in application.yml</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="property-example-3-use-group-name-or-group-id-to-protect-some-method-in-web-application"><a class="anchor" href="#property-example-3-use-group-name-or-group-id-to-protect-some-method-in-web-application"></a><a class="link" href="#property-example-3-use-group-name-or-group-id-to-protect-some-method-in-web-application">Property example 3: Use <code>group name</code> or <code>group id</code> to protect some method in web application.</a></h5>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>Step 1: Add property in application.yml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
azure:
  active-directory:
    user-group:
      allowed-group-names: group1_name_1, group2_name_2
      # 1. If allowed-group-ids == all, then all group id will take effect.
      # 2. If "all" is used, we should not configure other group ids.
      # 3. "all" is only supported for allowed-group-ids, not supported for allowed-group-names.
      allowed-group-ids: group_id_1, group_id_2</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 2: Add <code>@EnableGlobalMethodSecurity(prePostEnabled == true)</code> in web application:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled == true)
public class AADOAuth2LoginSecurityConfig extends AADWebSecurityConfigurerAdapter {

    /**
     * Add configuration logic as needed.
     */
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        super.configure(http);
        http.authorizeRequests()
                .anyRequest().authenticated();
        // Do some custom configuration
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can protect the method by <code>@PreAuthorize</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller
public class RoleController {
    @GetMapping("group1")
    @ResponseBody
    @PreAuthorize("hasRole('ROLE_group1')")
    public String group1() {
        return "group1 message";
    }

    @GetMapping("group2")
    @ResponseBody
    @PreAuthorize("hasRole('ROLE_group2')")
    public String group2() {
        return "group2 message";
    }

    @GetMapping("group1Id")
    @ResponseBody
    @PreAuthorize("hasRole('ROLE_&lt;group1-id&gt;')")
    public String group1Id() {
        return "group1Id message";
    }

    @GetMapping("group2Id")
    @ResponseBody
    @PreAuthorize("hasRole('ROLE_&lt;group2-id&gt;')")
    public String group2Id() {
        return "group2Id message";
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-example-4-incremental-consent-in-web-application-visiting-resource-servers"><a class="anchor" href="#property-example-4-incremental-consent-in-web-application-visiting-resource-servers"></a><a class="link" href="#property-example-4-incremental-consent-in-web-application-visiting-resource-servers">Property example 4: <a href="https://docs.microsoft.com/azure/active-directory/azuread-dev/azure-ad-endpoint-comparison#incremental-and-dynamic-consent">Incremental consent</a> in Web application visiting resource servers.</a></h5>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>Step 1: Add property in application.yml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
azure:
  active-directory:
    authorization-clients:
      graph:
        scopes: https://graph.microsoft.com/Analytics.Read, email
      arm: # client registration id
        on-demand: true  # means incremental consent
        scopes: https://management.core.windows.net/user_impersonation</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 2: Write Java code:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After these steps. <code>arm&#8217;s scopes (<a href="https://management.core.windows.net/user_impersonation" class="bare">management.core.windows.net/user_impersonation</a>) doesn&#8217;t
need to be consented at login time. When user request `/arm</code> endpoint, user need to consent the
scope. That&#8217;s <code>incremental consent</code> means.</p>
</div>
<div class="paragraph">
<p>After the scopes have been consented, AAD server will remember that this user has already granted
the permission to the web application. So incremental consent will not happen anymore after user
consented.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-example-5-client-credential-flow-in-resource-server-visiting-resource-servers"><a class="anchor" href="#property-example-5-client-credential-flow-in-resource-server-visiting-resource-servers"></a><a class="link" href="#property-example-5-client-credential-flow-in-resource-server-visiting-resource-servers">Property example 5: [Client credential flow] in resource server visiting resource servers.</a></h5>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>Step 1: Add property in application.yml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
azure:
  active-directory:
    authorization-clients:
      webapiC:                          # When authorization-grant-type is null, on behalf of flow is used by default
        authorization-grant-type: client_credentials
        scopes:
            - &lt;Web-API-C-app-id-url&gt;/.default</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 2: Write Java code:</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-usage-4"><a class="anchor" href="#basic-usage-4"></a><a class="link" href="#basic-usage-4">10.1.3. Basic Usage</a></h4>
<div class="sect4">
<h5 id="accessing-a-web-application"><a class="anchor" href="#accessing-a-web-application"></a><a class="link" href="#accessing-a-web-application">Accessing a web application</a></h5>
<div class="paragraph">
<p>This scenario uses the <a href="https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow">The OAuth 2.0 authorization code grant</a> flow to login in a user with a Microsoft account.</p>
</div>
<div class="paragraph">
<p><strong>System diagram</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142617664-f1704adb-db64-49e0-b1b6-078c62b6945b.png" alt="Standalone Web Application"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1: Make sure <code>redirect URI</code> has been set to <code>{application-base-uri}/login/oauth2/code/</code>, for
example <code><a href="http://localhost:8080/login/oauth2/code/" class="bare">localhost:8080/login/oauth2/code/</a></code>. Note the tailing <code>/</code> cannot be omitted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142617751-154c156c-9035-4641-9b79-b26380ddad72.png" alt="web-application-set-redirect-uri-1.png"></span>
<span class="image"><img src="https://user-images.githubusercontent.com/13167207/142617785-b4ca1afc-79f6-48ae-b7a3-99fba5856689.png" alt="web-application-set-redirect-uri-2.png"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 2: Add the following dependencies in your pom.xml.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-azure-starter-active-directory&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>Step 3: Add properties in application.yml. These values should be got in <a href="https://github.com/Azure/azure-sdk-for-java/tree/main/sdk/spring/azure-spring-boot-starter-active-directory#prerequisites">prerequisite</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
azure:
  active-directory:
    tenant-id: xxxxxx-your-tenant-id-xxxxxx
    client-id: xxxxxx-your-client-id-xxxxxx
    client-secret: xxxxxx-your-client-secret-xxxxxx</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 4: Write your Java code:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>AADWebSecurityConfigurerAdapter</code> contains necessary web security configuration for <strong>aad-starter</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="web-application-accessing-resource-servers"><a class="anchor" href="#web-application-accessing-resource-servers"></a><a class="link" href="#web-application-accessing-resource-servers">Web application accessing resource servers</a></h5>
<div class="paragraph">
<p><strong>System diagram</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142617853-0526205f-fdef-47f9-ac01-77963f8c34be.png" alt="web-application-visiting-resource-servers.png"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1: Make sure <code>redirect URI</code> has been set, just like <a href="https://github.com/Azure/azure-sdk-for-java/tree/main/sdk/spring/azure-spring-boot-starter-active-directory#accessing-a-web-application">Accessing a web application</a>.</p>
</li>
<li>
<p>Step 2: Add the following dependencies in you pom.xml.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-azure-starter-active-directory&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>Step 3: Add properties in application.yml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
azure:
  active-directory:
    tenant-id: xxxxxx-your-tenant-id-xxxxxx
    client-id: xxxxxx-your-client-id-xxxxxx
    client-secret: xxxxxx-your-client-secret-xxxxxx
    authorization-clients:
      graph:
        scopes: https://graph.microsoft.com/Analytics.Read, email</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>graph</code> is the name of <code>OAuth2AuthorizedClient</code>, <code>scopes</code> means the scopes need to consent when login.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 4: Write your Java code:</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="accessing-a-resource-server"><a class="anchor" href="#accessing-a-resource-server"></a><a class="link" href="#accessing-a-resource-server">Accessing a resource server</a></h5>
<div class="paragraph">
<p>This scenario doesn&#8217;t support login, just protect the server by validating the access_token. If the access token is valid, the server serves the request.</p>
</div>
<div class="paragraph">
<p><strong>System diagram</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142617910-1ee3eb6a-ddc7-4b85-af4e-71344c91b248.png" alt="Standalone resource server usage"></span></p>
</div>
<div class="paragraph">
<p>To use <strong>aad-starter</strong> in this scenario, we need these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1: Add the following dependencies in you pom.xml.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-azure-starter-active-directory&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 2: Add properties in application.yml:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142617979-167e7509-b82e-4475-99b7-91bcf0ec249c.png" alt="get-app-id-uri-1.png"></span>
<span class="image"><img src="https://user-images.githubusercontent.com/13167207/142618069-074289df-11aa-4d2c-ac8e-9a8a61c96288.png" alt="get-app-id-uri-2.png"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 3: Write Java code:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>AADResourceServerWebSecurityConfigurerAdapter</code> contains necessary web security configuration for resource server.</p>
</div>
</div>
<div class="sect4">
<h5 id="resource-server-visiting-other-resource-servers"><a class="anchor" href="#resource-server-visiting-other-resource-servers"></a><a class="link" href="#resource-server-visiting-other-resource-servers">Resource server visiting other resource servers</a></h5>
<div class="paragraph">
<p>This scenario support visit other resource servers in resource servers.</p>
</div>
<div class="paragraph">
<p><strong>System diagram</strong>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142618294-aa546ced-d241-4fbd-97ac-fb06881503b1.png" alt="resource-server-visiting-other-resource-servers.png"></span></p>
</div>
<div class="paragraph">
<p>To use <strong>aad-starter</strong> in this scenario, we need these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1: Add the following dependencies in you pom.xml.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-azure-starter-active-directory&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>Step 2: Add properties in application.yml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
azure:
  active-directory:
    tenant-id: &lt;Tenant-id-registered-by-application&gt;
    client-id: &lt;Web-API-A-client-id&gt;
    client-secret: &lt;Web-API-A-client-secret&gt;
    app-id-uri: &lt;Web-API-A-app-id-url&gt;
    authorization-clients:
      graph:
        scopes:
          - https://graph.microsoft.com/User.Read</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 3: Write Java code:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using <code>@RegisteredOAuth2AuthorizedClient</code> to access related resource server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SampleController {
    @PreAuthorize("hasAuthority('SCOPE_Obo.Graph.Read')")
    @GetMapping("call-graph")
    public String callGraph(@RegisteredOAuth2AuthorizedClient("graph") OAuth2AuthorizedClient graph) {
        return callMicrosoftGraphMeEndpoint(graph);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="web-application-and-resource-server-in-one-application"><a class="anchor" href="#web-application-and-resource-server-in-one-application"></a><a class="link" href="#web-application-and-resource-server-in-one-application">Web application and Resource server in one application</a></h5>
<div class="paragraph">
<p>This scenario supports <code>Web application</code> and <code>Resource server</code> in one application.</p>
</div>
<div class="paragraph">
<p>To use <strong>aad-starter</strong> in this scenario, we need these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1: Add the following dependencies in you pom.xml.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-azure-starter-active-directory&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 2: Add properties in application.yml:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Set property <code>spring.cloud.azure.active-directory.application-type</code> to <code>web_application_and_resource_server</code>, and specify the authorization type for each authorization client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    azure:
      active-directory:
        tenant-id: &lt;Tenant-id-registered-by-application&gt;
        client-id: &lt;Web-API-C-client-id&gt;
        client-secret: &lt;Web-API-C-client-secret&gt;
        app-id-uri: &lt;Web-API-C-app-id-url&gt;
        application-type: web_application_and_resource_server  # This is required.
        authorization-clients:
          graph:
            authorizationGrantType: authorization_code # This is required.
            scopes:
              - https://graph.microsoft.com/User.Read
              - https://graph.microsoft.com/Directory.Read.All</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 3: Write Java code:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configure multiple HttpSecurity instances, <code>AADOAuth2SecurityMultiConfig</code> contain two security configurations for resource server and web application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled == true)
public class AADWebApplicationAndResourceServerConfig {

    @Order(1)
    @Configuration
    public static class ApiWebSecurityConfigurationAdapter extends AADResourceServerWebSecurityConfigurerAdapter {
        protected void configure(HttpSecurity http) throws Exception {
            super.configure(http);
            // All the paths that match `/api/**`(configurable) work as `Resource Server`, other paths work as `Web application`.
            http.antMatcher("/api/**")
                .authorizeRequests().anyRequest().authenticated();
        }
    }

    @Configuration
    public static class HtmlWebSecurityConfigurerAdapter extends AADWebSecurityConfigurerAdapter {

        @Override
        protected void configure(HttpSecurity http) throws Exception {
            super.configure(http);
            // @formatter:off
            http.authorizeRequests()
                    .antMatchers("/login").permitAll()
                    .anyRequest().authenticated();
            // @formatter:on
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="samples-4"><a class="anchor" href="#samples-4"></a><a class="link" href="#samples-4">10.1.4. Samples</a></h4>
<div class="paragraph">
<p>(todo: @chenrujun Add link here.)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-security-with-azure-ad-b2c"><a class="anchor" href="#spring-security-with-azure-ad-b2c"></a><a class="link" href="#spring-security-with-azure-ad-b2c">10.2. Spring Security with Azure AD B2C</a></h3>
<div class="sect3">
<h4 id="dependency-setup-5"><a class="anchor" href="#dependency-setup-5"></a><a class="link" href="#dependency-setup-5">10.2.1. Dependency Setup</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-azure-starter-active-directory-b2c&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-6"><a class="anchor" href="#configuration-6"></a><a class="link" href="#configuration-6">10.2.2. Configuration</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.base-uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base uri for authorization server, if both <code>tenant</code> and <code>baseUri</code> are configured at the same time, only <code>baseUri</code> takes effect.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.client-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The registered application ID in Azure AD B2C.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.client-secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The client secret of a registered application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.authorization-clients</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map to list all authorization clients created on Azure Portal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.login-flow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key name of sign in user flow.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.logout-success-url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target URL after a successful logout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.tenant(Deprecated)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Azure AD B2C&#8217;s tenant name, this is only suitable for Global cloud.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.tenant-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Azure AD B2C&#8217;s tenant id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.user-flows</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map to list all user flows defined on Azure Portal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.azure.active-directory.b2c.user-name-attribute-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The the attribute name of the user name.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For full configurations, check appendix.</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-usage-5"><a class="anchor" href="#basic-usage-5"></a><a class="link" href="#basic-usage-5">10.2.3. Basic Usage</a></h4>
<div class="paragraph">
<p>A <code>web application</code> is any web based application that allows user to login Azure AD, whereas a <code>resource server</code> will either
accept or deny access after validating access_token obtained from Azure AD. We will cover 4 scenarios in this guide:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Accessing a web application.</p>
</li>
<li>
<p>Web application accessing resource servers.</p>
</li>
<li>
<p>Accessing a resource server.</p>
</li>
<li>
<p>Resource server accessing other resource servers.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142620440-f970b572-2646-4f50-9f77-db62d6e965f1.png" alt="B2C Web application &amp; Web Api Overall"></span></p>
</div>
<div class="sect4">
<h5 id="accessing-a-web-application-2"><a class="anchor" href="#accessing-a-web-application-2"></a><a class="link" href="#accessing-a-web-application-2">Accessing a web application</a></h5>
<div class="paragraph">
<p>This scenario uses the <a href="https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow">The OAuth 2.0 authorization code grant</a> flow to login in a user with your Azure AD B2C user.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <strong>Azure AD B2C</strong> from the portal menu, click <strong>Applications</strong>, and then click <strong>Add</strong>.</p>
</li>
<li>
<p>Specify your application <strong>Name</strong>, we call it <code>webapp</code>, add <code><a href="http://localhost:8080/login/oauth2/code/" class="bare">localhost:8080/login/oauth2/code/</a></code> for the <strong>Reply URL</strong>, record the
<strong>Application ID</strong> as your <code>${your-webapp-client-id}</code> and then click <strong>Save</strong>.</p>
</li>
<li>
<p>Select <strong>Keys</strong> from your application, click <strong>Generate key</strong> to generate <code>${your-webapp-client-secret}</code> and then <strong>Save</strong>.</p>
</li>
<li>
<p>Select <strong>User flows</strong> on your left, and then Click <strong>New user flow</strong>.</p>
</li>
<li>
<p>Choose <strong>Sign up or in</strong>, <strong>Profile editing</strong> and <strong>Password reset</strong> to create user flows
respectively. Specify your user flow <strong>Name</strong> and <strong>User attributes and claims</strong>, click <strong>Create</strong>.</p>
</li>
<li>
<p>Select <strong>API permissions</strong> &gt; <strong>Add a permission</strong> &gt; <strong>Microsoft APIs</strong>, select <strong><em>Microsoft Graph</em></strong>,
select <strong>Delegated permissions</strong>, check <strong>offline_access</strong> and <strong>openid</strong> permissions, select <strong>Add permission</strong> to complete the process.</p>
</li>
<li>
<p>Grant admin consent for <strong><em>Graph</em></strong> permissions.
<span class="image"><img src="https://user-images.githubusercontent.com/13167207/142620491-8c8a82ea-c920-43a8-aa0a-dd028f1b8553.png" alt="Add Graph permissions"></span></p>
</li>
<li>
<p>Add the following dependencies in your <em>pom.xml</em>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
        &lt;artifactId&gt;azure-spring-boot-starter-active-directory-b2c&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;
        &lt;artifactId&gt;thymeleaf-extras-springsecurity5&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add properties in <em>application.yml</em> using the values you created earlier, for example:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  cloud:
   azure:
     active-directory:
       b2c:
         authenticate-additional-parameters:
           domain_hint: xxxxxxxxx         # optional
           login_hint: xxxxxxxxx          # optional
           prompt: [login,none,consent]   # optional
         base-uri: ${your-tenant-authorization-server-base-uri}
         client-id: ${your-webapp-client-id}
         client-secret: ${your-webapp-client-secret}
         login-flow: ${your-login-user-flow-key}               # default to sign-up-or-sign-in, will look up the user-flows map with provided key.
         logout-success-url: ${you-logout-success-url}
         user-flows:
           ${your-user-flow-key}: ${your-user-flow-name-defined-on-azure-portal}
         user-name-attribute-name: ${your-user-name-attribute-name}</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Write your Java code.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Controller code can refer to the following:</p>
</div>
<div class="paragraph">
<p>Security configuration code can refer to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EnableWebSecurity
public class WebSecurityConfiguration extends WebSecurityConfigurerAdapter {

    private final AADB2COidcLoginConfigurer configurer;

    public WebSecurityConfiguration(AADB2COidcLoginConfigurer configurer) {
        this.configurer == configurer;
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        // @formatter:off
        http.authorizeRequests()
                .anyRequest().authenticated()
                .and()
            .apply(configurer);
        // @formatter:off
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the <em>home.html</em> from <a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/aad/azure-spring-boot-sample-active-directory-b2c-oidc/src/main/resources/templates">Azure AD B2C Spring Boot Sample</a>, and replace the <code>${your-profile-edit-user-flow}</code> and <code>${your-password-reset-user-flow}</code> with your user flow name respectively that completed earlier.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and test your app</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let <code>Webapp</code> run on port <em>8080</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="web-application-accessing-resource-servers-2"><a class="anchor" href="#web-application-accessing-resource-servers-2"></a><a class="link" href="#web-application-accessing-resource-servers-2">Web application accessing resource servers</a></h5>
<div class="paragraph">
<p>This scenario is based on <strong>Accessing a web application</strong> scenario to allow application to access other resources, that is [The OAuth 2.0 client credentials grant] flow.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <strong>Azure AD B2C</strong> from the portal menu, click <strong>Applications</strong>, and then click <strong>Add</strong>.</p>
</li>
<li>
<p>Specify your application <strong>Name</strong>, we call it <code>webApiA</code>, record the <strong>Application ID</strong> as your <code>${your-web-api-a-client-id}</code> and then click <strong>Save</strong>.</p>
</li>
<li>
<p>Select <strong>Keys</strong> from your application, click <strong>Generate key</strong> to generate <code>${your-web-api-a-client-secret}</code> and then <strong>Save</strong>.</p>
</li>
<li>
<p>Select <strong>Expose an API</strong> on your left, and then Click the <strong>Set</strong> link, specify your resource app id url suffix, such as <em>web-api-a</em>,
record the <strong>Application ID URI</strong> as your <code>${your-web-api-a-app-id-url}</code>, then <strong>Save</strong>.</p>
</li>
<li>
<p>Select <strong>Manifest</strong> on your left, and then paste the below json segment into <code>appRoles</code> array,
record the <strong>Application ID URI</strong> as your <code>${your-web-api-a-app-id-url}</code>, record the value of the app role as your <code>${your-web-api-a-role-value}</code>, then <strong>save</strong>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "allowedMemberTypes": [
    "Application"
  ],
  "description": "WebApiA.SampleScope",
  "displayName": "WebApiA.SampleScope",
  "id": "04989db0-3efe-4db6-b716-ae378517d2b7",
  "isEnabled": true,
  "value": "WebApiA.SampleScope"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142620567-59a91df7-7a97-4027-b525-1f422f25fb22.png" alt="Configure WebApiA appRoles"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <strong>API permissions</strong> &gt; <strong>Add a permission</strong> &gt; <strong>My APIs</strong>, select <strong><em>WebApiA</em></strong> application name,
select <strong>Application Permissions</strong>, select <strong>WebApiA.SampleScope</strong> permission, select <strong>Add permission</strong> to complete the process.</p>
</li>
<li>
<p>Grant admin consent for <strong><em>WebApiA</em></strong> permissions.
<span class="image"><img src="https://user-images.githubusercontent.com/13167207/142620601-660400fa-7cff-4989-9d7f-2b32a9aa1244.png" alt="Add WebApiA permission"></span></p>
</li>
<li>
<p>Add the following dependency on the basis of <strong>Accessing a web application</strong> scenario.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the following configuration on the basis of <strong>Accessing a web application</strong> scenario.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  cloud:
   azure:
     active-directory:
       b2c:
         base-uri: ${your-base-uri}             # Such as: https://xxxxb2c.b2clogin.com
         tenant-id: ${your-tenant-id}
         authorization-clients:
           ${your-resource-server-a-name}:
             authorization-grant-type: client_credentials
             scopes: ${your-web-api-a-app-id-url}/.default</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Write your <code>Webapp</code> Java code.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Controller code can refer to the following:</p>
</div>
<div class="paragraph">
<p>Security configuration code is the same with <strong>Accessing a web application</strong> scenario, another bean `webClient`is added as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SampleConfiguration {
        @Bean
        public WebClient webClient(OAuth2AuthorizedClientManager oAuth2AuthorizedClientManager) {
                ServletOAuth2AuthorizedClientExchangeFilterFunction function =
                        new ServletOAuth2AuthorizedClientExchangeFilterFunction(oAuth2AuthorizedClientManager);
                return WebClient.builder()
                                                .apply(function.oauth2Configuration())
                                                .build();
        }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please refer to <strong>Accessing a resource server</strong> section to write your <code>WebApiA</code> Java code.</p>
</li>
<li>
<p>Build and test your app</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let <code>Webapp</code> and <code>WebApiA</code> run on port <em>8080</em> and <em>8081</em> respectively.
 Start <code>Webapp</code> and <code>WebApiA</code> application, return to the home page after logging successfully, you can access <code><a href="http://localhost:8080/webapp/webApiA" class="bare">localhost:8080/webapp/webApiA</a></code> to get <strong>WebApiA</strong> resource response.</p>
</div>
</div>
<div class="sect4">
<h5 id="accessing-a-resource-server-2"><a class="anchor" href="#accessing-a-resource-server-2"></a><a class="link" href="#accessing-a-resource-server-2">Accessing a resource server</a></h5>
<div class="paragraph">
<p>This scenario not support login. Just protect the server by validating the access token, and if valid, serves the request.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Refer to <a href="#web-application-accessing-resource-servers">Web application accessing resource servers</a> to build your <code>WebApiA</code> permission.</p>
</li>
<li>
<p>Add <code>WebApiA</code> permission and grant admin consent for your web application.</p>
</li>
<li>
<p>Add the following dependencies in your <em>pom.xml</em>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
        &lt;artifactId&gt;azure-spring-boot-starter-active-directory-b2c&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the following configuration.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  cloud:
   azure:
     active-directory:
       b2c:
         base-uri: ${your-base-uri}             # Such as: https://xxxxb2c.b2clogin.com
         tenant-id: ${your-tenant-id}
         app-id-uri: ${your-app-id-uri}         # If you are using v1.0 token, please configure app-id-uri for `aud` verification
         client-id: ${your-client-id}           # If you are using v2.0 token, please configure client-id for `aud` verification</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Write your Java code.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Controller code can refer to the following:</p>
</div>
<div class="paragraph">
<p>Security configuration code can refer to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled == true)
public class ResourceServerConfiguration extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.authorizeRequests((requests) -&gt; requests.anyRequest().authenticated())
            .oauth2ResourceServer()
            .jwt()
            .jwtAuthenticationConverter(new AADJwtBearerTokenAuthenticationConverter());
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and test your app</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let <code>WebApiA</code> run on port <em>8081</em>.
 Get the access token for <code>webApiA</code> resource and access <code><a href="http://localhost:8081/webApiA/sample" class="bare">localhost:8081/webApiA/sample</a></code>
 as the Bearer authorization header.</p>
</div>
</div>
<div class="sect4">
<h5 id="resource-server-accessing-other-resource-servers"><a class="anchor" href="#resource-server-accessing-other-resource-servers"></a><a class="link" href="#resource-server-accessing-other-resource-servers">Resource server accessing other resource servers</a></h5>
<div class="paragraph">
<p>This scenario is an upgrade of <strong>Accessing a resource server</strong>, supports access to other application resources, based on OAuth2 client credentials flow.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Referring to the previous steps, we create a <code>WebApiB</code> application and expose an application permission <code>WebApiB.SampleScope</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "allowedMemberTypes": [
        "Application"
    ],
    "description": "WebApiB.SampleScope",
    "displayName": "WebApiB.SampleScope",
    "id": "04989db0-3efe-4db6-b716-ae378517d2b7",
    "isEnabled": true,
    "lang": null,
    "origin": "Application",
    "value": "WebApiB.SampleScope"
}</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142620648-cfbf5220-9736-4050-a3ef-1370c522e672.png" alt="Configure WebApiB appRoles"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Grant admin consent for <strong><em>WebApiB</em></strong> permissions.
<span class="image"><img src="https://user-images.githubusercontent.com/13167207/142620691-b1a7fcda-fc92-41af-9515-812139f26ee0.png" alt="Add WebApiB permission"></span></p>
</li>
<li>
<p>On the basis of <strong>Accessing a resource server</strong>, add a dependency in your <em>pom.xml</em>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
 &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
 &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the following configuration on the basis of <strong>Accessing a resource server</strong> scenario configuration.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  cloud:
   azure:
     active-directory:
       b2c:
         client-secret: ${your-web-api-a-client-secret}
         authorization-clients:
           ${your-resource-server-b-name}:
             authorization-grant-type: client_credentials
             scopes: ${your-web-api-b-app-id-url}/.default</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Write your Java code.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>WebApiA controller code can refer to the following:</p>
</div>
<div class="paragraph">
<p>WebApiB controller code can refer to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SampleController {
        /**
         * webApiB resource api for other web application
         * @return test content
         */
        @PreAuthorize("hasAuthority('APPROLE_WebApiB.SampleScope')")
        @GetMapping("/webApiB/sample")
        public String webApiBSample() {
                LOGGER.info("Call webApiBSample()");
                return "Request '/webApiB/sample'(WebApi B) returned successfully.";
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Security configuration code is the same with <strong>Accessing a resource server</strong> scenario, another bean `webClient`is added as follows</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build and test your app</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let <code>WebApiA</code> and <code>WebApiB</code> run on port <em>8081</em> and <em>8082</em> respectively.
 Start <code>WebApiA</code> and <code>WebApiB</code> application, get the access token for <code>webApiA</code> resource and access <code><a href="http://localhost:8081/webApiA/webApiB/sample" class="bare">localhost:8081/webApiA/webApiB/sample</a></code>
 as the Bearer authorization header.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="samples-5"><a class="anchor" href="#samples-5"></a><a class="link" href="#samples-5">10.2.4. Samples</a></h4>
<div class="sect4">
<h5 id="accessing-a-web-application-3"><a class="anchor" href="#accessing-a-web-application-3"></a><a class="link" href="#accessing-a-web-application-3">Accessing a web application</a></h5>
<div class="paragraph">
<p>Please refer to <a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/aad/azure-spring-boot-sample-active-directory-b2c-oidc">azure-spring-boot-sample-active-directory-b2c-oidc</a>. (todo: @chenrujun. update this link)</p>
</div>
</div>
<div class="sect4">
<h5 id="accessing-a-resource-server-3"><a class="anchor" href="#accessing-a-resource-server-3"></a><a class="link" href="#accessing-a-resource-server-3">Accessing a resource server</a></h5>
<div class="paragraph">
<p>Please refer to <a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/aad/azure-spring-boot-sample-active-directory-b2c-resource-server">azure-spring-boot-sample-active-directory-b2c-resource-server</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-integration-support"><a class="anchor" href="#spring-integration-support"></a><a class="link" href="#spring-integration-support">11. Spring Integration Support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Integration Extension for Azure provides Spring Integration adapters for the various services provided by the <a href="https://github.com/Azure/azure-sdk-for-java/">Azure SDK for Java</a>. Below is a list of supported adapters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring-integration-azure-eventhbus</p>
</li>
<li>
<p>spring-integration-azure-servicebus</p>
</li>
<li>
<p>spring-integration-azure-storage-queue</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Provide Spring Integration support for these Azure serices: eh, sb, storage q</p>
</div>
<div class="sect2">
<h3 id="spring-integration-with-azure-event-hubs"><a class="anchor" href="#spring-integration-with-azure-event-hubs"></a><a class="link" href="#spring-integration-with-azure-event-hubs">11.1. Spring Integration with Azure Event Hubs</a></h3>
<div class="sect3">
<h4 id="dependency-setup-6"><a class="anchor" href="#dependency-setup-6"></a><a class="link" href="#dependency-setup-6">11.1.1. Dependency Setup</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
    &lt;artifactId&gt;azure-spring-integration-eventhubs&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-7"><a class="anchor" href="#configuration-7"></a><a class="link" href="#configuration-7">11.1.2. Configuration</a></h4>
<div class="paragraph">
<p>for full configurations, check appendix</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-usage-6"><a class="anchor" href="#basic-usage-6"></a><a class="link" href="#basic-usage-6">11.1.3. Basic Usage</a></h4>

</div>
<div class="sect3">
<h4 id="samples-6"><a class="anchor" href="#samples-6"></a><a class="link" href="#samples-6">11.1.4. Samples</a></h4>
<div class="paragraph">
<p>Please refer to this <a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/eventhubs/azure-spring-integration-sample-eventhubs">sample project</a> to learn how to use Event Hubs integration. (todo: @chenrujun, update this link)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-integration-with-azure-service-bus"><a class="anchor" href="#spring-integration-with-azure-service-bus"></a><a class="link" href="#spring-integration-with-azure-service-bus">11.2. Spring Integration with Azure Service Bus</a></h3>
<div class="sect3">
<h4 id="dependency-setup-7"><a class="anchor" href="#dependency-setup-7"></a><a class="link" href="#dependency-setup-7">11.2.1. Dependency Setup</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
    &lt;artifactId&gt;azure-spring-integration-servicebus&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-8"><a class="anchor" href="#configuration-8"></a><a class="link" href="#configuration-8">11.2.2. Configuration</a></h4>
<div class="paragraph">
<p>for full configurations, check appendix</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-usage-7"><a class="anchor" href="#basic-usage-7"></a><a class="link" href="#basic-usage-7">11.2.3. Basic Usage</a></h4>

</div>
<div class="sect3">
<h4 id="samples-7"><a class="anchor" href="#samples-7"></a><a class="link" href="#samples-7">11.2.4. Samples</a></h4>
<div class="paragraph">
<p><strong>Example: Manually set the partition key for the message</strong></p>
</div>
<div class="paragraph">
<p>This example demonstrates how to manually set the partition key for the message in the application.</p>
</div>
<div class="paragraph">
<p><strong>Way 1:</strong>
This example requires that <code>spring.cloud.stream.default.producer.partitionKeyExpression</code> be set <code>&quot;&#39;partitionKey-&#39; + headers[&lt;message-header-key&gt;]&quot;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    azure:
      servicebus:
        connection-string: [servicebus-namespace-connection-string]
    stream:
      default:
        producer:
          partitionKeyExpression:  "'partitionKey-' + headers[&lt;message-header-key&gt;]"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SampleController {
    @PostMapping("/messages")
    public ResponseEntity&lt;String&gt; sendMessage(@RequestParam String message) {
        LOGGER.info("Going to add message {} to Sinks.Many.", message);
        many.emitNext(MessageBuilder.withPayload(message)
                                    .setHeader("&lt;message-header-key&gt;", "Customize partition key")
                                    .build(), Sinks.EmitFailureHandler.FAIL_FAST);
        return ResponseEntity.ok("Sent!");
    }
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>NOTE:</strong> When using <code>application.yml</code> to configure the partition key, its priority will be the lowest.
It will take effect only when the <code>ServiceBusMessageHeaders.SESSION_ID</code>, <code>ServiceBusMessageHeaders.PARTITION_KEY</code>, <code>AzureHeaders.PARTITION_KEY</code> are not configured.
<strong>Way 2:</strong>
Manually add the partition Key in the message header by code.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><em>Recommended:</em> Use <code>ServiceBusMessageHeaders.PARTITION_KEY</code> as the key of the header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SampleController {
    @PostMapping("/messages")
    public ResponseEntity&lt;String&gt; sendMessage(@RequestParam String message) {
        LOGGER.info("Going to add message {} to Sinks.Many.", message);
        many.emitNext(MessageBuilder.withPayload(message)
                                    .setHeader(ServiceBusMessageHeaders.PARTITION_KEY, "Customize partition key")
                                    .build(), Sinks.EmitFailureHandler.FAIL_FAST);
        return ResponseEntity.ok("Sent!");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Not recommended but currently supported:</em> <code>AzureHeaders.PARTITION_KEY</code> as the key of the header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SampleController {
    @PostMapping("/messages")
    public ResponseEntity&lt;String&gt; sendMessage(@RequestParam String message) {
        LOGGER.info("Going to add message {} to Sinks.Many.", message);
        many.emitNext(MessageBuilder.withPayload(message)
                                    .setHeader(AzureHeaders.PARTITION_KEY, "Customize partition key")
                                    .build(), Sinks.EmitFailureHandler.FAIL_FAST);
        return ResponseEntity.ok("Sent!");
    }
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>NOTE:</strong> When both <code>ServiceBusMessageHeaders.PARTITION_KEY</code> and <code>AzureHeaders.PARTITION_KEY</code> are set in the message headers,
<code>ServiceBusMessageHeaders.PARTITION_KEY</code> is preferred.
<strong>Example: Set the session id for the message</strong></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This example demonstrates how to manually set the session id of a message in the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class SampleController {
    @PostMapping("/messages")
    public ResponseEntity&lt;String&gt; sendMessage(@RequestParam String message) {
        LOGGER.info("Going to add message {} to Sinks.Many.", message);
        many.emitNext(MessageBuilder.withPayload(message)
                                    .setHeader(ServiceBusMessageHeaders.SESSION_ID, "Customize session id")
                                    .build(), Sinks.EmitFailureHandler.FAIL_FAST);
        return ResponseEntity.ok("Sent!");
    }
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>NOTE:</strong> When the <code>ServiceBusMessageHeaders.SESSION_ID</code> is set in the message headers, and a different <code>ServiceBusMessageHeaders.PARTITION_KEY</code> (or <code>AzureHeaders.PARTITION_KEY</code>) header is also set,
the value of the session id will eventually be used to overwrite the value of the partition key.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-integration-with-azure-storage-queue"><a class="anchor" href="#spring-integration-with-azure-storage-queue"></a><a class="link" href="#spring-integration-with-azure-storage-queue">11.3. Spring Integration with Azure Storage Queue</a></h3>
<div class="sect3">
<h4 id="dependency-setup-8"><a class="anchor" href="#dependency-setup-8"></a><a class="link" href="#dependency-setup-8">11.3.1. Dependency Setup</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
    &lt;artifactId&gt;azure-spring-integration-storage-queue&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-9"><a class="anchor" href="#configuration-9"></a><a class="link" href="#configuration-9">11.3.2. Configuration</a></h4>
<div class="paragraph">
<p>for full configurations, check appendix</p>
</div>
</div>
<div class="sect3">
<h4 id="basic-usage-8"><a class="anchor" href="#basic-usage-8"></a><a class="link" href="#basic-usage-8">11.3.3. Basic Usage</a></h4>

</div>
<div class="sect3">
<h4 id="samples-8"><a class="anchor" href="#samples-8"></a><a class="link" href="#samples-8">11.3.4. Samples</a></h4>
<div class="paragraph">
<p>Please refer to this <a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/tag_azure-spring-boot_3.6.0/storage/azure-spring-integration-sample-storage-queue">sample project</a> illustrating how to use Storage Queue integration.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-cloud-stream-support"><a class="anchor" href="#spring-cloud-stream-support"></a><a class="link" href="#spring-cloud-stream-support">12. Spring Cloud Stream Support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Cloud Stream is a framework for building highly scalable event-driven microservices connected with shared messaging systems.</p>
</div>
<div class="paragraph">
<p>The framework provides a flexible programming model built on already established and familiar Spring idioms and best practices, including support for persistent pub/sub semantics, consumer groups, and stateful partitions.</p>
</div>
<div class="paragraph">
<p>Current binder implementations include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring-cloud-azure-stream-binder-eventhubs</p>
</li>
<li>
<p>spring-cloud-azure-stream-binder-servicebus</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="spring-cloud-stream-binder-for-azure-event-hubs"><a class="anchor" href="#spring-cloud-stream-binder-for-azure-event-hubs"></a><a class="link" href="#spring-cloud-stream-binder-for-azure-event-hubs">12.1. Spring Cloud Stream Binder for Azure Event Hubs</a></h3>
<div class="sect3">
<h4 id="dependency-setup-9"><a class="anchor" href="#dependency-setup-9"></a><a class="link" href="#dependency-setup-9">12.1.1. Dependency Setup</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-azure-stream-binder-eventhubs&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-10"><a class="anchor" href="#configuration-10"></a><a class="link" href="#configuration-10">12.1.2. Configuration</a></h4>
<div class="paragraph">
<p>The binder provides the following configuration options in <code>application.properties</code>.</p>
</div>
<div class="sect4">
<h5 id="spring-cloud-azure-properties"><a class="anchor" href="#spring-cloud-azure-properties"></a><a class="link" href="#spring-cloud-azure-properties">Spring Cloud Azure Properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.auto-create-resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enable auto-creation for Azure resources</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Region name of the Azure resource group, e.g. westus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if spring.cloud.azure.auto-create-resources is enabled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Cloud name for Azure resources, supported values are <code>azure</code>, <code>azurechina</code>, <code>azure_germany</code> and <code>azureusgovernment</code> which are case insensitive</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client-id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client (application) id of a service principal or Managed Service Identity (MSI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if service principal or MSI is used as credential configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client-secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client secret of a service principal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if service principal is used as credential configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.msi-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enable MSI as credential configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if MSI is used as credential configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.resource-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of Azure resource group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if service principal or MSI is used as credential configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.subscription-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription id of an MSI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if MSI is used as credential configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.tenant-id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tenant id of a service principal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if service principal is used as credential configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.eventhub.connection-string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event Hubs Namespace connection string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if connection string is used as Event Hubs credential configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.eventhub.checkpoint-storage-account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">StorageAccount name for message checkpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.eventhub.checkpoint-access-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">StorageAccount access key for message checkpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if StorageAccount access key is used as StorageAccount credential configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.eventhub.checkpoint-container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StorageAccount container name for message checkpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.eventhub.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event Hub Namespace. Auto creating if missing</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="common-producer-properties"><a class="anchor" href="#common-producer-properties"></a><a class="link" href="#common-producer-properties">Common Producer Properties</a></h5>
<div class="paragraph">
<p>You can use the producer configurations of <strong>Spring Cloud Stream</strong>,
it uses the configuration with the format of <code>spring.cloud.stream.bindings.&lt;channelName&gt;.producer</code>.</p>
</div>
<div class="sect5">
<h6 id="partition-configuration"><a class="anchor" href="#partition-configuration"></a><a class="link" href="#partition-configuration">Partition configuration</a></h6>
<div class="paragraph">
<p>The system will obtain the parameter <code>PartitionSupply</code> to send the message,
the following is the process of obtaining the priority of the partition ID and key:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://user-images.githubusercontent.com/13167207/142611562-38dfd834-47e6-4b8c-ba7d-b811f88a2821.png" alt="Create PartitionSupply parameter process"></span></p>
</div>
<div class="paragraph">
<p>The following are configuration items related to the producer:</p>
</div>
<div class="paragraph">
<p><strong><em>partition-count</em></strong></p>
</div>
<div class="paragraph">
<p>The number of target partitions for the data, if partitioning is enabled.</p>
</div>
<div class="paragraph">
<p>Default: 1</p>
</div>
<div class="paragraph">
<p><strong><em>partition-key-extractor-name</em></strong></p>
</div>
<div class="paragraph">
<p>The name of the bean that implements <code>PartitionKeyExtractorStrategy</code>.
The partition handler will first use the <code>PartitionKeyExtractorStrategy#extractKey</code> method to obtain the partition key value.</p>
</div>
<div class="paragraph">
<p>Default: null</p>
</div>
<div class="paragraph">
<p><strong><em>partition-key-expression</em></strong></p>
</div>
<div class="paragraph">
<p>A SpEL expression that determines how to partition outbound data.
When interface <code>PartitionKeyExtractorStrategy</code> is not implemented, it will be called in the method <code>PartitionHandler#extractKey</code>.</p>
</div>
<div class="paragraph">
<p>Default: null</p>
</div>
<div class="paragraph">
<p>For more information about setting partition for the producer properties, please refer to the <a href="https://docs.spring.io/spring-cloud-stream/docs/current/reference/html/spring-cloud-stream.html#_producer_properties">Producer Properties of Spring Cloud Stream</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="event-hub-producer-properties"><a class="anchor" href="#event-hub-producer-properties"></a><a class="link" href="#event-hub-producer-properties">Event Hub Producer Properties</a></h5>
<div class="paragraph">
<p>It supports the following configurations with the format of <code>spring.cloud.stream.eventhubs.bindings.&lt;channelName&gt;.producer</code>.</p>
</div>
<div class="paragraph">
<p><strong><em>sync</em></strong></p>
</div>
<div class="paragraph">
<p>Whether the producer should act in a synchronous manner with respect to writing messages into a stream. If true, the
producer will wait for a response from Event Hub after a send operation.</p>
</div>
<div class="paragraph">
<p>Default: <code>false</code></p>
</div>
<div class="paragraph">
<p><strong><em>send-timeout</em></strong></p>
</div>
<div class="paragraph">
<p>Effective only if <code>sync</code> is set to true. The amount of time to wait for a response from Event Hub after a send operation, in milliseconds.</p>
</div>
<div class="paragraph">
<p>Default: <code>10000</code></p>
</div>
</div>
<div class="sect4">
<h5 id="common-consumer-properties"><a class="anchor" href="#common-consumer-properties"></a><a class="link" href="#common-consumer-properties">Common Consumer Properties</a></h5>
<div class="paragraph">
<p>You can use the below consumer configurations of <strong>Spring Cloud Stream</strong>,
it uses the configuration with the format of <code>spring.cloud.stream.bindings.&lt;channelName&gt;.consumer</code>.</p>
</div>
<div class="sect5">
<h6 id="batch-consumer"><a class="anchor" href="#batch-consumer"></a><a class="link" href="#batch-consumer">Batch Consumer</a></h6>
<div class="paragraph">
<p>When <code>spring.cloud.stream.bindings.&lt;binding-name&gt;.consumer.batch-mode</code> is set to <code>true</code>, all of the received events
will be presented as a <code>List&lt;?&gt;</code> to the consumer function. Otherwise, the function will be called with one event at a time.
The size of the batch is controlled by Event Hubs consumer properties <code>max-size</code>(required) and <code>max-wait-time</code>
(optional); refer to the <a href="#event-hub-consumer-properties">below section</a> for more information.</p>
</div>
<div class="paragraph">
<p><strong><em>batch-mode</em></strong></p>
</div>
<div class="paragraph">
<p>Whether to enable the entire batch of messages to be passed to the consumer function in a <code>List</code>.</p>
</div>
<div class="paragraph">
<p>Default: <code>False</code></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="event-hub-consumer-properties"><a class="anchor" href="#event-hub-consumer-properties"></a><a class="link" href="#event-hub-consumer-properties">Event Hub Consumer Properties</a></h5>
<div class="paragraph">
<p>It supports the following configurations with the format of <code>spring.cloud.stream.eventhubs.bindings.&lt;channelName&gt;.consumer</code>.</p>
</div>
<div class="paragraph">
<p><strong><em>start-position</em></strong></p>
</div>
<div class="paragraph">
<p>Whether the consumer receives messages from the beginning or end of event hub. if <code>EARLIEST</code>, from beginning. If
<code>LATEST</code>, from end.</p>
</div>
<div class="paragraph">
<p>Default: <code>LATEST</code></p>
</div>
<div class="paragraph">
<p><strong><em>checkpoint-mode</em></strong></p>
</div>
<div class="paragraph">
<p>The mode in which checkpoints are updated.</p>
</div>
<div class="paragraph">
<p><code>RECORD</code>, <code>default</code> mode. Checkpoints occur after each record is successfully processed by user-defined message
handler without any exception. If you use <code>StorageAccount</code> as checkpoint store, this might become bottleneck.</p>
</div>
<div class="paragraph">
<p><code>BATCH</code>, checkpoints occur after each batch of messages successfully processed by user-defined message handler
without any exception. Be aware that batch size could be any value and <code>BATCH</code> mode is only supported when consume
batch
mode is set true.</p>
</div>
<div class="paragraph">
<p><code>MANUAL</code>, checkpoints occur on demand by the user via the <code>Checkpointer</code>. You can do checkpoints after the message has been successfully processed. <code>Message.getHeaders.get(AzureHeaders.CHECKPOINTER)`callback can get you the `Checkpointer</code> you need. Please be aware all messages in the corresponding Event Hub partition before this message will be considered as successfully processed.</p>
</div>
<div class="paragraph">
<p><code>PARTITION_COUNT</code>, checkpoints occur after the count of messages defined by <code>checkpoint_count</code> successfully processed for each partition. You may experience reprocessing at most <code>checkpoint_count</code> of when message processing fails.</p>
</div>
<div class="paragraph">
<p><code>Time</code>, checkpoints occur at fixed time interval specified by <code>checkpoint_interval</code>. You may experience reprocessing of messages during this time interval when message processing fails.</p>
</div>
<div class="paragraph">
<p>Default: <code>RECORD</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>Notes: when consume batch mode is false(default value), `BATCH` checkpoint mode is not invalid.</pre>
</div>
</div>
<div class="paragraph">
<p><strong><em>checkpoint-count</em></strong></p>
</div>
<div class="paragraph">
<p>Effectively only when <code>checkpoint-mode</code> is <code>PARTITION_COUNT</code>. Decides the amount of message for each partition to do one checkpoint.</p>
</div>
<div class="paragraph">
<p>Default: <code>10</code></p>
</div>
<div class="paragraph">
<p><strong><em>checkpoint-interval</em></strong></p>
</div>
<div class="paragraph">
<p>Effectively only when <code>checkpoint-mode</code> is <code>Time</code>. Decides The time interval to do one checkpoint.</p>
</div>
<div class="paragraph">
<p>Default: <code>5s</code></p>
</div>
<div class="paragraph">
<p><strong><em>max-size</em></strong></p>
</div>
<div class="paragraph">
<p>The maximum number of events that will be in the list of a message payload when the consumer callback is invoked.</p>
</div>
<div class="paragraph">
<p>Default: <code>10</code></p>
</div>
<div class="paragraph">
<p><strong><em>max-wait-time</em></strong></p>
</div>
<div class="paragraph">
<p>The max time <code>Duration</code> to wait to receive a batch of events up to the max batch size before invoking the consumer callback.</p>
</div>
<div class="paragraph">
<p>Default: <code>null</code></p>
</div>
<div class="paragraph">
<p>for full configurations, check appendix</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-usage-9"><a class="anchor" href="#basic-usage-9"></a><a class="link" href="#basic-usage-9">12.1.3. Basic Usage</a></h4>

</div>
<div class="sect3">
<h4 id="samples-9"><a class="anchor" href="#samples-9"></a><a class="link" href="#samples-9">12.1.4. Samples</a></h4>

</div>
<div class="sect3">
<h4 id="error-channels"><a class="anchor" href="#error-channels"></a><a class="link" href="#error-channels">12.1.5. Error Channels</a></h4>
<div class="paragraph">
<p><strong><em>consumer error channel</em></strong></p>
</div>
<div class="paragraph">
<p>this channel is open by default, you can handle the error message in this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    // Replace destination with spring.cloud.stream.bindings.input.destination
    // Replace group with spring.cloud.stream.bindings.input.group
    @ServiceActivator(inputChannel == "{destination}.{group}.errors")
    public void consumerError(Message&lt;?&gt; message) {
        LOGGER.error("Handling customer ERROR: " + message);
    }</pre>
</div>
</div>
<div class="paragraph">
<p><strong><em>producer error channel</em></strong></p>
</div>
<div class="paragraph">
<p>this channel is not open by default, if you want to open it. You need to add a configuration in your application.properties, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.cloud.stream.default.producer.errorChannelEnabled=true</pre>
</div>
</div>
<div class="paragraph">
<p>you can handle the error message in this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    // Replace destination with spring.cloud.stream.bindings.output.destination
    @ServiceActivator(inputChannel == "{destination}.errors")
    public void producerError(Message&lt;?&gt; message) {
        LOGGER.error("Handling Producer ERROR: " + message);
    }</pre>
</div>
</div>
<div class="sect4">
<h5 id="batch-consumer-sample"><a class="anchor" href="#batch-consumer-sample"></a><a class="link" href="#batch-consumer-sample">Batch Consumer Sample</a></h5>
<div class="sect5">
<h6 id="configuration-options"><a class="anchor" href="#configuration-options"></a><a class="link" href="#configuration-options">Configuration Options</a></h6>
<div class="paragraph">
<p>To enable the batch consumer mode, you should add below configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    stream:
      bindings:
        consume-in-0:
          destination: {event-hub-name}
          group: [consumer-group-name]
          consumer:
            batch-mode: true
      eventhubs:
        bindings:
          consume-in-0:
            consumer:
              checkpoint:
                mode: BATCH # or MANUAL as needed
              batch:
                max-size: 2 # The default value is 10
                max-wait-time: 1m # Optional, the default value is null</code></pre>
</div>
</div>
<div class="paragraph">
<p>======= Consume messages in batches</p>
</div>
<div class="paragraph">
<p>For checkpointing mode as BATCH, you can use below code to send messages and consume in batches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Bean
    public Consumer&lt;List&lt;String&gt;&gt; consume() {
        return list -&gt; list.forEach(event -&gt; LOGGER.info("New event received: '{}'",event));
    }
    @Bean
    public Supplier&lt;Message&lt;String&gt;&gt; supply() {
        return () -&gt; {
            LOGGER.info("Sending message, sequence " + i);
            return MessageBuilder.withPayload("\"test"+ i++ +"\"").build();
        };
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For checkpointing mode as MANUAL, you can use below code to send messages and consume/checkpoint in batches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Bean
    public Consumer&lt;Message&lt;List&lt;String&gt;&gt;&gt; consume() {
        return message -&gt; {
            for (int i == 0; i &lt; message.getPayload().size(); i++) {
                LOGGER.info("New message received: '{}', partition key: {}, sequence number: {}, offset: {}, enqueued time: {}",
                    message.getPayload().get(i),
                    ((List&lt;Object&gt;) message.getHeaders().get(EventHubsHeaders.PARTITION_KEY)).get(i),
                    ((List&lt;Object&gt;) message.getHeaders().get(EventHubsHeaders.SEQUENCE_NUMBER)).get(i),
                    ((List&lt;Object&gt;) message.getHeaders().get(EventHubsHeaders.OFFSET)).get(i),
                    ((List&lt;Object&gt;) message.getHeaders().get(EventHubsHeaders.ENQUEUED_TIME)).get(i));
            }

            Checkpointer checkpointer == (Checkpointer) message.getHeaders().get(CHECKPOINTER);
            checkpointer.success()
                        .doOnSuccess(success -&gt; LOGGER.info("Message '{}' successfully checkpointed", message.getPayload()))
                        .doOnError(error -&gt; LOGGER.error("Exception found", error))
                        .subscribe();
        };
    }
    @Bean
    public Supplier&lt;Message&lt;String&gt;&gt; supply() {
        return () -&gt; {
            LOGGER.info("Sending message, sequence " + i);
            return MessageBuilder.withPayload("\"test"+ i++ +"\"").build();
        };
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-cloud-stream-binder-for-azure-service-bus"><a class="anchor" href="#spring-cloud-stream-binder-for-azure-service-bus"></a><a class="link" href="#spring-cloud-stream-binder-for-azure-service-bus">12.2. Spring Cloud Stream Binder for Azure Service Bus</a></h3>
<div class="sect3">
<h4 id="dependency-setup-10"><a class="anchor" href="#dependency-setup-10"></a><a class="link" href="#dependency-setup-10">12.2.1. Dependency Setup</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-azure-stream-binder-servicebus&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-11"><a class="anchor" href="#configuration-11"></a><a class="link" href="#configuration-11">12.2.2. Configuration</a></h4>
<div class="paragraph">
<p>The binder provides the following configuration options:</p>
</div>
<div class="sect4">
<h5 id="spring-cloud-azure-properties-2"><a class="anchor" href="#spring-cloud-azure-properties-2"></a><a class="link" href="#spring-cloud-azure-properties-2">Spring Cloud Azure Properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.auto-create-resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enable auto-creation for Azure resources</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Region name of the Azure resource group, e.g. westus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if spring.cloud.azure.auto-create-resources is enabled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Cloud name for Azure resources, supported values are <code>azure</code>, <code>azurechina</code>, <code>azure_germany</code> and <code>azureusgovernment</code> which are case insensitive</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client-id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client (application) id of a service principal or Managed Service Identity (MSI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if service principal or MSI is used as credential configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client-secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client secret of a service principal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if service principal is used as credential configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.msi-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enable MSI as credential configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if MSI is used as credential configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.resource-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of Azure resource group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if service principal or MSI is used as credential configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.subscription-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription id of an MSI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if MSI is used as credential configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.tenant-id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tenant id of a service principal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if service principal is used as credential configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.servicebus.connection-string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Bus Namespace connection string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if connection string is used as credential configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.servicebus.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Bus Namespace. Auto creating if missing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if service principal or MSI is used as credential configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.servicebus.transportType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Bus transportType, supported value of <code>AMQP</code> and <code>AMQP_WEB_SOCKETS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AMQP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.servicebus.retry-Options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Bus retry options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value of AmqpRetryOptions</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="partition-configuration-2"><a class="anchor" href="#partition-configuration-2"></a><a class="link" href="#partition-configuration-2">Partition configuration</a></h5>
<div class="paragraph">
<p>The system will obtain the parameter <code>PartitionSupply</code> to send the message.</p>
</div>
<div class="paragraph">
<p>The following are configuration items related to the producer:</p>
</div>
<div class="paragraph">
<p><strong><em>partition-count</em></strong></p>
</div>
<div class="paragraph">
<p>The number of target partitions for the data, if partitioning is enabled.</p>
</div>
<div class="paragraph">
<p>Default: 1</p>
</div>
<div class="paragraph">
<p><strong><em>partition-key-extractor-name</em></strong></p>
</div>
<div class="paragraph">
<p>The name of the bean that implements <code>PartitionKeyExtractorStrategy</code>.
The partition handler will first use the <code>PartitionKeyExtractorStrategy#extractKey</code> method to obtain the partition key value.</p>
</div>
<div class="paragraph">
<p>Default: null</p>
</div>
<div class="paragraph">
<p><strong><em>partition-key-expression</em></strong></p>
</div>
<div class="paragraph">
<p>A SpEL expression that determines how to partition outbound data.
When interface <code>PartitionKeyExtractorStrategy</code> is not implemented, it will be called in the method <code>PartitionHandler#extractKey</code>.</p>
</div>
<div class="paragraph">
<p>Default: null</p>
</div>
<div class="paragraph">
<p>For more information about setting partition for the producer properties, please refer to the <a href="https://docs.spring.io/spring-cloud-stream/docs/current/reference/html/spring-cloud-stream.html#_producer_properties">Producer Properties of Spring Cloud Stream</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="serivce-bus-queue-producer-properties"><a class="anchor" href="#serivce-bus-queue-producer-properties"></a><a class="link" href="#serivce-bus-queue-producer-properties">Serivce Bus Queue Producer Properties</a></h5>
<div class="paragraph">
<p>It supports the following configurations with the format of <code>spring.cloud.stream.servicebus.queue.bindings.&lt;channelName&gt;.producer</code>.</p>
</div>
<div class="paragraph">
<p><strong><em>sync</em></strong></p>
</div>
<div class="paragraph">
<p>Whether the producer should act in a synchronous manner with respect to writing messages into a stream. If true, the
producer will wait for a response after a send operation.</p>
</div>
<div class="paragraph">
<p>Default: <code>false</code></p>
</div>
<div class="paragraph">
<p><strong><em>send-timeout</em></strong></p>
</div>
<div class="paragraph">
<p>Effective only if <code>sync</code> is set to true. The amount of time to wait for a response after a send operation, in milliseconds.</p>
</div>
<div class="paragraph">
<p>Default: <code>10000</code></p>
</div>
</div>
<div class="sect4">
<h5 id="service-bus-queue-consumer-properties"><a class="anchor" href="#service-bus-queue-consumer-properties"></a><a class="link" href="#service-bus-queue-consumer-properties">Service Bus Queue Consumer Properties</a></h5>
<div class="paragraph">
<p>It supports the following configurations with the format of <code>spring.cloud.stream.servicebus.queue.bindings.&lt;channelName&gt;.consumer</code>.</p>
</div>
<div class="paragraph">
<p><strong><em>checkpoint-mode</em></strong></p>
</div>
<div class="paragraph">
<p>The mode in which checkpoints are updated.</p>
</div>
<div class="paragraph">
<p><code>RECORD</code>, checkpoints occur after each record successfully processed by user-defined message handler without any exception.</p>
</div>
<div class="paragraph">
<p><code>MANUAL</code>, checkpoints occur on demand by the user via the <code>Checkpointer</code>. You can get <code>Checkpointer</code> by `Message.getHeaders.get(AzureHeaders.CHECKPOINTER)`callback.</p>
</div>
<div class="paragraph">
<p>Default: <code>RECORD</code></p>
</div>
<div class="paragraph">
<p><strong><em>prefetch-count</em></strong></p>
</div>
<div class="paragraph">
<p>Prefetch count of underlying service bus client.</p>
</div>
<div class="paragraph">
<p>Default: <code>1</code></p>
</div>
<div class="paragraph">
<p><strong><em>maxConcurrentCalls</em></strong></p>
</div>
<div class="paragraph">
<p>Controls the max concurrent calls of service bus message handler and the size of fixed thread pool that handles user&#8217;s business logic</p>
</div>
<div class="paragraph">
<p>Default: <code>1</code></p>
</div>
<div class="paragraph">
<p><strong><em>maxConcurrentSessions</em></strong></p>
</div>
<div class="paragraph">
<p>Controls the maximum number of concurrent sessions to process at any given time.</p>
</div>
<div class="paragraph">
<p>Default: <code>1</code></p>
</div>
<div class="paragraph">
<p><strong><em>concurrency</em></strong></p>
</div>
<div class="paragraph">
<p>When <code>sessionsEnabled</code> is true, controls the maximum number of concurrent sessions to process at any given time.
When <code>sessionsEnabled</code> is false, controls the max concurrent calls of service bus message handler and the size of fixed thread pool that handles user&#8217;s business logic.</p>
</div>
<div class="paragraph">
<p>Deprecated, replaced with <code>maxConcurrentSessions</code> when <code>sessionsEnabled</code> is true and <code>maxConcurrentCalls</code> when <code>sessionsEnabled</code> is false</p>
</div>
<div class="paragraph">
<p>Default: <code>1</code></p>
</div>
<div class="paragraph">
<p><strong><em>sessionsEnabled</em></strong></p>
</div>
<div class="paragraph">
<p>Controls if is a session aware consumer. Set it to <code>true</code> if is a queue with sessions enabled.</p>
</div>
<div class="paragraph">
<p>Default: <code>false</code></p>
</div>
<div class="paragraph">
<p><strong><em>requeueRejected</em></strong></p>
</div>
<div class="paragraph">
<p>Controls if is a message that trigger any exception in consumer will be force to DLQ.
Set it to <code>true</code> if a message that trigger any exception in consumer will be force to DLQ.
Set it to <code>false</code> if a message that trigger any exception in consumer will be re-queued.</p>
</div>
<div class="paragraph">
<p>Default: <code>false</code></p>
</div>
<div class="paragraph">
<p><strong><em>receiveMode</em></strong></p>
</div>
<div class="paragraph">
<p>The modes for receiving messages.</p>
</div>
<div class="paragraph">
<p><code>PEEK_LOCK</code>, received message is not deleted from the queue or subscription, instead it is temporarily locked to the receiver, making it invisible to other receivers.</p>
</div>
<div class="paragraph">
<p><code>RECEIVE_AND_DELETE</code>, received message is removed from the queue or subscription and immediately deleted.</p>
</div>
<div class="paragraph">
<p>Default: <code>PEEK_LOCK</code></p>
</div>
<div class="paragraph">
<p><strong><em>enableAutoComplete</em></strong></p>
</div>
<div class="paragraph">
<p>Enable auto-complete and auto-abandon of received messages.
'enableAutoComplete' is not needed in for RECEIVE_AND_DELETE mode.</p>
</div>
<div class="paragraph">
<p>Default: <code>false</code></p>
</div>
</div>
<div class="sect4">
<h5 id="support-for-service-bus-message-headers-and-properties"><a class="anchor" href="#support-for-service-bus-message-headers-and-properties"></a><a class="link" href="#support-for-service-bus-message-headers-and-properties">Support for Service Bus Message Headers and Properties</a></h5>
<div class="paragraph">
<p>The following table illustrates how Spring message headers are mapped to Service Bus message headers and properties.
When create a message, developers can specify the header or property of a Service Bus message by below constants.</p>
</div>
<div class="paragraph">
<p>For some Service Bus headers that can be mapped to multiple Spring header constants, the priority of different Spring headers is listed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service Bus Message Headers and Properties</th>
<th class="tableblock halign-left valign-top">Spring Message Header Constants</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Priority Number (Descending priority)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MessageId</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.converter.ServiceBusMessageHeaders.MESSAGE_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MessageId</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.AzureHeaders.RAW_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MessageId</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.springframework.messaging.MessageHeaders.ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UUID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ContentType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.springframework.messaging.MessageHeaders.CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReplyTo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.springframework.messaging.MessageHeaders.REPLY_CHANNEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ScheduledEnqueueTimeUtc</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.converter.ServiceBusMessageHeaders.SCHEDULED_ENQUEUE_TIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OffsetDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ScheduledEnqueueTimeUtc</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.AzureHeaders.SCHEDULED_ENQUEUE_MESSAGE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeToLive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.converter.ServiceBusMessageHeaders.TIME_TO_LIVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SessionID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.converter.ServiceBusMessageHeaders.SESSION_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CorrelationId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.converter.ServiceBusMessageHeaders.CORRELATION_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.converter.ServiceBusMessageHeaders.TO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReplyToSessionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.converter.ServiceBusMessageHeaders.REPLY_TO_SESSION_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PartitionKey</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.converter.ServiceBusMessageHeaders.PARTITION_KEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PartitionKey</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.AzureHeaders.PARTITION_KEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For full configurations, check appendix</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-usage-10"><a class="anchor" href="#basic-usage-10"></a><a class="link" href="#basic-usage-10">12.2.3. Basic Usage</a></h4>

</div>
<div class="sect3">
<h4 id="samples-10"><a class="anchor" href="#samples-10"></a><a class="link" href="#samples-10">12.2.4. Samples</a></h4>
<div class="paragraph">
<p><strong>Example: Manually set the partition key for the message</strong></p>
</div>
<div class="paragraph">
<p>This example demonstrates how to manually set the partition key for the message in the application.</p>
</div>
<div class="paragraph">
<p><strong>Way 1:</strong>
This example requires that <code>spring.cloud.stream.default.producer.partitionKeyExpression</code> be set <code>&quot;&#39;partitionKey-&#39; + headers[&lt;message-header-key&gt;]&quot;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    azure:
      servicebus:
        connection-string: [servicebus-namespace-connection-string]
    stream:
      default:
        producer:
          partitionKeyExpression:  "'partitionKey-' + headers[&lt;message-header-key&gt;]"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@PostMapping("/messages")
public ResponseEntity&lt;String&gt; sendMessage(@RequestParam String message) {
    LOGGER.info("Going to add message {} to Sinks.Many.", message);
    many.emitNext(MessageBuilder.withPayload(message)
                                .setHeader("&lt;message-header-key&gt;", "Customize partirion key")
                                .build(), Sinks.EmitFailureHandler.FAIL_FAST);
    return ResponseEntity.ok("Sent!");
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>NOTE:</strong> When using <code>application.yml</code> to configure the partition key, its priority will be the lowest.
It will take effect only when the <code>ServiceBusMessageHeaders.SESSION_ID</code>, <code>ServiceBusMessageHeaders.PARTITION_KEY</code>, <code>AzureHeaders.PARTITION_KEY</code> are not configured.
<strong>Way 2:</strong>
Manually add the partition Key in the message header by code.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><em>Recommended:</em> Use <code>ServiceBusMessageHeaders.PARTITION_KEY</code> as the key of the header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@PostMapping("/messages")
public ResponseEntity&lt;String&gt; sendMessage(@RequestParam String message) {
    LOGGER.info("Going to add message {} to Sinks.Many.", message);
    many.emitNext(MessageBuilder.withPayload(message)
                                .setHeader(ServiceBusMessageHeaders.PARTITION_KEY, "Customize partirion key")
                                .build(), Sinks.EmitFailureHandler.FAIL_FAST);
    return ResponseEntity.ok("Sent!");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Not recommended but currently supported:</em> <code>AzureHeaders.PARTITION_KEY</code> as the key of the header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@PostMapping("/messages")
public ResponseEntity&lt;String&gt; sendMessage(@RequestParam String message) {
    LOGGER.info("Going to add message {} to Sinks.Many.", message);
    many.emitNext(MessageBuilder.withPayload(message)
                                .setHeader(AzureHeaders.PARTITION_KEY, "Customize partirion key")
                                .build(), Sinks.EmitFailureHandler.FAIL_FAST);
    return ResponseEntity.ok("Sent!");
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>NOTE:</strong> When both <code>ServiceBusMessageHeaders.PARTITION_KEY</code> and <code>AzureHeaders.PARTITION_KEY</code> are set in the message headers,
<code>ServiceBusMessageHeaders.PARTITION_KEY</code> is preferred.
<strong>Example: Set the session id for the message</strong></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This example demonstrates how to manually set the session id of a message in the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@PostMapping("/messages")
public ResponseEntity&lt;String&gt; sendMessage(@RequestParam String message) {
    LOGGER.info("Going to add message {} to Sinks.Many.", message);
    many.emitNext(MessageBuilder.withPayload(message)
                                .setHeader(ServiceBusMessageHeaders.SESSION_ID, "Customize session id")
                                .build(), Sinks.EmitFailureHandler.FAIL_FAST);
    return ResponseEntity.ok("Sent!");
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>NOTE:</strong> When the <code>ServiceBusMessageHeaders.SESSION_ID</code> is set in the message headers, and a different <code>ServiceBusMessageHeaders.PARTITION_KEY</code> (or <code>AzureHeaders.PARTITION_KEY</code>) header is also set,
the value of the session id will eventually be used to overwrite the value of the partition key.
Please use this <code>sample</code> as a reference to learn more about how to use this binder in your project.
- <a href="https://github.com/Azure-Samples/azure-spring-boot-samples/tree/main/servicebus/azure-spring-cloud-stream-binder-servicebus-queue">Service Bus Queue</a></p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kafka-support"><a class="anchor" href="#kafka-support"></a><a class="link" href="#kafka-support">13. Kafka Support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Connect to Azure Event Hubs using Spring Kafka libraries.</p>
</div>
<div class="sect2">
<h3 id="dependency-setup-11"><a class="anchor" href="#dependency-setup-11"></a><a class="link" href="#dependency-setup-11">13.1. Dependency Setup</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-azure-resourcemanager&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-azure-starter&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
  &lt;artifactId&gt;spring-cloud-starter-stream-kafka&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-12"><a class="anchor" href="#configuration-12"></a><a class="link" href="#configuration-12">13.2. Configuration</a></h3>
<div class="paragraph">
<p>This Spring Cloud Azure Starter provides the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Properties</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.profile</strong>.tenant-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tenant id for Azure resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.profile</strong>.subscription-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription id to use when connecting to Azure resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.credential</strong>.client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client id to use when performing service principal authentication with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.credential</strong>.client-secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription id to use when connecting to Azure resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.credential</strong>.managed-identity-client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client id to use when using managed identity to authenticate with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.credential</strong>.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to use when performing username/password authentication with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.credential</strong>.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username to use when performing username/password authentication with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.credential</strong>.client-certificate-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password of the certificate file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.credential</strong>.client-certificate-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path of a PEM certificate file to use when performing service principal authentication with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.eventhubs</strong>.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure Event Hubs namespace.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>spring.cloud.azure.eventhubs</strong>.resource.resource-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The resource group of Azure Event Hubs namespace.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="basic-usage-11"><a class="anchor" href="#basic-usage-11"></a><a class="link" href="#basic-usage-11">13.3. Basic Usage</a></h3>
<div class="paragraph">
<p>Spring Cloud Azure provides multiple methods to authenticate requests inside Azure Service. The following configuration is commonly used for service principal authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    azure:
      profile:
        tenant-id: ${SPRING_TENANT_ID}
        subscription-id: ${SPRING_SUBSCRIPTION_ID}
      credential:
        client-id: ${SPRING_CLIENT_ID}
        client-secret: ${SPRING_CLIENT_SECRET}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="samples-11"><a class="anchor" href="#samples-11"></a><a class="link" href="#samples-11">13.4. Samples</a></h3>
<div class="paragraph">
<p>The following code sample demonstrates how to use the Spring Cloud Azure Starter and Spring Cloud Starter Stream Kafka for Azure Event Hub. The sample app exposes a RESTful API to receive string message. Then message is sent through Azure Event Hub to a bean <code>consumer</code> which simply logs the message.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a service principal for use in by your app. Please follow
<a href="https://github.com/Azure-Samples/azure-spring-boot-samples/blob/main/create-sp-using-azure-cli.md">create service principal from Azure CLI</a>.
The credential is not required since Spring Cloud Azure support <a href="https://docs.microsoft.com/en-us/azure/developer/java/sdk/identity" class="bare">docs.microsoft.com/en-us/azure/developer/java/sdk/identity</a>,
you only need to log in with az cli / vs code or Intellij Azure Toolkit, then credential information will be left out of properties</p>
</li>
<li>
<p>Create <a href="https://docs.microsoft.com/azure/event-hubs/">Azure Event Hubs</a>.</p>
</li>
<li>
<p>Update
<a href="https://github.com/Azure-Samples/azure-spring-boot-samples/blob/spring-cloud-azure_4.0/eventhubs/spring-cloud-azure-starter/spring-cloud-azure-sample-eventhubs-kafka/src/main/resources/application.yaml">application.yaml</a> file</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    azure:
      profile:
        tenant-id: ${SPRING_TENANT_ID}
        subscription-id: ${SPRING_SUBSCRIPTION_ID}
# This is not required since Spring Cloud Azure support https://docs.microsoft.com/en-us/azure/developer/java/sdk/identity
# you only need to login with az cli / vs code or Intellij Azure Toolkit
# then credential information will be left out of properties
#      credential:
#        client-id: ${SPRING_CLIENT_ID}
#        client-secret: ${SPRING_CLIENT_SECRET}
      eventhubs:
        namespace: ${EVENTHUB_NAMESPACE_NAME_SAMPLE_EVENTHUBS_KAFKA}
        resource:
          resource-group: ${SPRING_RESOURCE_GROUP}
    stream:
      function:
        definition: consume;supply
      bindings:
        consume-in-0:
          destination: sample-eventhubs-kafka
          group: $Default
        supply-out-0:
          destination: sample-eventhubs-kafka</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use this controller code to catch key
<a href="https://github.com/Azure-Samples/azure-spring-boot-samples/blob/spring-cloud-azure_4.0/eventhubs/spring-cloud-azure-starter/spring-cloud-azure-sample-eventhubs-kafka/src/main/java/com/azure/spring/sample/eventhubs/kafka/SourceExample.java">SourceExample.java</a> file</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RestController
public class SourceExample {

    @Autowired
    private Sinks.Many&lt;Message&lt;String&gt;&gt; many;

    @PostMapping("/messages")
    public String sendMessage(@RequestParam String message) {
        many.emitNext(new GenericMessage&lt;&gt;(message), Sinks.EmitFailureHandler.FAIL_FAST);
        return message;
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Spring boot start class
<a href="https://github.com/Azure-Samples/azure-spring-boot-samples/blob/spring-cloud-azure_4.0/eventhubs/spring-cloud-azure-starter/spring-cloud-azure-sample-eventhubs-kafka/src/main/java/com/azure/spring/sample/eventhubs/kafka/EventHubKafkaBinderApplication.java">EventHubKafkaBinderApplication.java</a> file</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SpringBootApplication
public class EventHubKafkaBinderApplication {

    private static final Logger LOGGER = LoggerFactory.getLogger(EventHubKafkaBinderApplication.class);

    public static void main(String[] args) {
        SpringApplication.run(EventHubKafkaBinderApplication.class, args);
    }

    @Bean
    public Sinks.Many&lt;Message&lt;String&gt;&gt; many() {
        return Sinks.many().unicast().onBackpressureBuffer();
    }

    @Bean
    public Supplier&lt;Flux&lt;Message&lt;String&gt;&gt;&gt; supply(Sinks.Many&lt;Message&lt;String&gt;&gt; many) {
        return () -&gt; many.asFlux()
                         .doOnNext(m -&gt; LOGGER.info("Manually sending message {}", m))
                         .doOnError(t -&gt; LOGGER.error("Error encountered", t));
    }

    @Bean
    public Consumer&lt;Message&lt;String&gt;&gt; consume() {
        return message -&gt; LOGGER.info("New message received: '{}'", message.getPayload());
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the <code>mvn spring-boot:run</code> in the root of the code sample to get the app running.</p>
</li>
<li>
<p>Send a POST request</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X POST http://localhost:8080/messages?message=hello</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify in your app’s logs that a similar message was posted:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>New message received: hello</code></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete the resources on <a href="https://ms.portal.azure.com/">Azure Portal</a> to avoid unexpected charges.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a><a class="link" href="#troubleshooting">13.5. Troubleshooting</a></h3>
<div class="ulist">
<ul>
<li>
<p>Meet with <code>Creating topics with default partitions/replication factor are only supported in CreateTopicRequest version 4+</code> error.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>`text
o.s.c.s.b.k.p.KafkaTopicProvisioner      : Failed to create topics
org.apache.kafka.common.errors.UnsupportedVersionException: Creating topics with default partitions/replication factor are only supported in CreateTopicRequest version 4+. The following topics need values for partitions and replicas
`</p>
</div>
<div class="paragraph">
<p>When this error is found, add this configuration item <code>spring.cloud.stream.kafka.binder.replicationFactor</code>, with the value set to at least 1. For more information, see <a href="https://docs.spring.io/spring-cloud-stream-binder-kafka/docs/current/reference/html/spring-cloud-stream-binder-kafka.html">Spring Cloud Stream Kafka Binder Reference Guide</a>.
== Redis Support</p>
</div>
<div class="paragraph">
<p>Connect to Azure Cache for Redis using Spring Redis libraries.</p>
</div>
</div>
<div class="sect2">
<h3 id="dependency-setup-12"><a class="anchor" href="#dependency-setup-12"></a><a class="link" href="#dependency-setup-12">13.6. Dependency Setup</a></h3>

</div>
<div class="sect2">
<h3 id="configuration-13"><a class="anchor" href="#configuration-13"></a><a class="link" href="#configuration-13">13.7. Configuration</a></h3>

</div>
<div class="sect2">
<h3 id="basic-usage-12"><a class="anchor" href="#basic-usage-12"></a><a class="link" href="#basic-usage-12">13.8. Basic Usage</a></h3>

</div>
<div class="sect2">
<h3 id="samples-12"><a class="anchor" href="#samples-12"></a><a class="link" href="#samples-12">13.9. Samples</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="resource-manager"><a class="anchor" href="#resource-manager"></a><a class="link" href="#resource-manager">14. Resource Manager</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dependency-setup-13"><a class="anchor" href="#dependency-setup-13"></a><a class="link" href="#dependency-setup-13">14.1. Dependency Setup</a></h3>

</div>
<div class="sect2">
<h3 id="configuration-14"><a class="anchor" href="#configuration-14"></a><a class="link" href="#configuration-14">14.2. Configuration</a></h3>
<div class="paragraph">
<p>for full configurations, check appendix</p>
</div>
</div>
<div class="sect2">
<h3 id="basic-usage-13"><a class="anchor" href="#basic-usage-13"></a><a class="link" href="#basic-usage-13">14.3. Basic Usage</a></h3>

</div>
<div class="sect2">
<h3 id="samples-13"><a class="anchor" href="#samples-13"></a><a class="link" href="#samples-13">14.4. Samples</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-properties"><a class="anchor" href="#configuration-properties"></a><a class="link" href="#configuration-properties">15. Configuration Properties</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Required?</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.application-id</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents current application and is used for telemetry/monitoring purposes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.amqp.transport-type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transport type for AMQP-based client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.headers</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-delimited list of headers applied to each request sent with client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.http.connect-timeout</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of time the request attempts to connect to the remote host and the connection is resolved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.http.connection-idle-timeout</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of time before an idle connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.http.logging.allowed-header-names</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-delimited list of whitelisted headers that should be logged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.http.logging.allowed-query-param-names</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-delimited list of whitelisted query parameters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.http.logging.level</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The level of detail to log on HTTP messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.http.logging.prettyPrintBody</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to pretty print the message bodies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.http.maximum-connection-pool-size</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum connection pool size used by the underlying HTTP client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.http.read-timeout</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of time used when reading the server response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client.http.write-timeout</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of time each request being sent over the w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.credential.client-certificate-password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password of the certificate file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.credential.client-certificate-path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path of a PEM certificate file to use when performing service principal authentication with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.credential.client-id</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client id to use when performing service principal authentication with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.credential.client-secret</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client secret to use when performing service principal authentication with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.credential.managed-identity-client-id</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client id to use when using managed identity to authenticate with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.credential.username</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username to use when performing username/password authentication with Azure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.credential.password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to use when performing username/password authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.profile.cloud</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Azure cloud to connect to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.profile.environment.active-directory-endpoint</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.profile.subscription</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription id to use when connecting to Azure resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.profile.tenant-id</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tenant id for Azure resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.proxy.authentication-type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication type used against the proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.proxy.hostname</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host of the proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.proxy.password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password used to authenticate with the proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.proxy.port</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port of the proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.proxy.type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.proxy.username</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username used to authenticate with the proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.proxy.http.non-proxy-hosts</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of hosts or CIDR to not use proxy HTTP/HTTPS connections through.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.retry.backoff.delay</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of time to wait between retry attempts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.retry.backoff.max-delay</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum permissible amount of time between retry attempts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.retry.backoff.multiplier</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplier used to calculate the next backoff delay. If positive, then used as a multiplier for generating the next delay for backoff.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.retry.http.retry-after-header</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP header, such as Retry-After or x-ms-retry-after-ms, to lookup for the retry delay.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.retry.http.retry-after-time-unit</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time unit to use when applying the retry delay.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.retry.max-attempts</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of attempts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.retry.timeout</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of time to wait until a timeout.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="migration-guide-for-4-0"><a class="anchor" href="#migration-guide-for-4-0"></a><a class="link" href="#migration-guide-for-4-0">16. Migration Guide for 4.0</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide assists in the migration to <strong>Spring Cloud Azure 4.0</strong> from legacy Azure Spring libraries.</p>
</div>
<div class="paragraph">
<p>We will call libraries whose group id and artifact id following pattern <code>com.azure.spring:spring-cloud-azure-<strong></code> the *modern libraries</strong>,
and those with pattern <code>com.azure.spring:azure-spring-boot-<strong></code>, <code>com.azure.spring:azure-spring-cloud-</strong></code> ,
or <code>com.azure.spring:azure-spring-integration-<strong></code> the *legacy</strong> ones.</p>
</div>
<div class="paragraph">
<p>This guide will focus the side-by-side comparisons for similar configurations between the modern and legacy libraries.</p>
</div>
<div class="paragraph">
<p>Familiarity with <code>com.azure.spring:azure-spring-boot-<strong></code>, <code>com.azure.spring:azure-spring-cloud-</strong></code>
or <code>com.azure.spring:azure-spring-integration-*</code> package is assumed.</p>
</div>
<div class="paragraph">
<p>For those new to the Spring Cloud Azure 4.0 libraries, please refer to the <a href="https://github.com/Azure/azure-sdk-for-java/wiki/Spring-Cloud-Azure-4.0-Reference">Spring Cloud Azure 4.0 Reference Doc</a> rather than this guide.</p>
</div>
<div class="sect2">
<h3 id="migration-benefits"><a class="anchor" href="#migration-benefits"></a><a class="link" href="#migration-benefits">16.1. Migration benefits</a></h3>
<div class="paragraph">
<p>A natural question to ask when considering whether to adopt a new version or library is its benefits. As Azure has
matured and been embraced by a more diverse group of developers, we have been focused on learning the patterns and
practices to best support developer productivity and to understand the gaps that the Spring Cloud Azure libraries have.</p>
</div>
<div class="paragraph">
<p>There were several areas of consistent feedback expressed across the Spring Cloud Azure libraries. The most important is
that the libraries for different Azure services have not enabled the complete set of configurations. Additionally, the
inconsistency of project naming, artifact ids, versions, configurations made the learning curve steep.</p>
</div>
<div class="paragraph">
<p>To improve the development experience across Spring Cloud Azure libraries, a set of design guidelines was introduced to
ensure that Spring Cloud Azure libraries have a natural and idiomatic feel with respect to the Spring ecosystem. Further
details are available in the <a href="https://github.com/Azure/azure-sdk-for-java/wiki/Spring-Cloud-Azure-4.0-design">design doc</a> for those interested.</p>
</div>
<div class="paragraph">
<p>The <strong>Spring Cloud Azure 4.0</strong> provides the shared experience across libraries integrating with different Spring
projects, for example Spring Boot, Spring Integration, Spring Cloud Stream, etc. The shared experience includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>[placeholder]</strong> An official name for the project?</p>
</li>
<li>
<p>A unified BOM to include all Spring Cloud Azure 4.0 libraries.</p>
</li>
<li>
<p>A consistent naming convention for artifacts.</p>
</li>
<li>
<p>A unified way to configure credential, proxy, retry, cloud environment, and transport layer settings.</p>
</li>
<li>
<p>Supporting all the authenticating methods an Azure Service or Azure Service SDK supports.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="overview"><a class="anchor" href="#overview"></a><a class="link" href="#overview">16.2. Overview</a></h3>
<div class="paragraph">
<p>This migration guide will be consisted of following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Naming changes for Spring Cloud Azure 4.0</p>
</li>
<li>
<p>Artifact changes: renamed / added / deleted</p>
</li>
<li>
<p>Configuration properties</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="naming-changes"><a class="anchor" href="#naming-changes"></a><a class="link" href="#naming-changes">16.3. Naming changes</a></h3>
<div class="paragraph">
<p>There has never been a consistent or official name to call all the Spring Cloud Azure libraries, some of them were
called <code>Azure Spring Boot</code> and some of them <code>Spring on Azure</code> , and all these names will make developer confused. Since
4.0, we began to use the project name <code>Spring Cloud Azure</code> to represent all the Azure Spring libraries.</p>
</div>
</div>
<div class="sect2">
<h3 id="bom"><a class="anchor" href="#bom"></a><a class="link" href="#bom">16.4. BOM</a></h3>
<div class="paragraph">
<p>We used to ship two BOMs for our libraries, the <code>azure-spring-boot-bom</code> and <code>azure-spring-cloud-dependencies</code>, but we
combined these two BOMs into one BOM since 4.0, the <code>spring-cloud-azure-dependencies</code>. Please add an entry in the
dependencyManagement of your project to benefit from the dependency management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencyManagement&gt;
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-azure-dependencies&lt;/artifactId&gt;
        &lt;version&gt;4.0.0-beta.1&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="artifact-changes-renamed-added-deleted"><a class="anchor" href="#artifact-changes-renamed-added-deleted"></a><a class="link" href="#artifact-changes-renamed-added-deleted">16.5. Artifact changes: renamed / added / deleted</a></h3>
<div class="paragraph">
<p>Group ids are the same for modern and legacy Spring Cloud Azure libraries, they are all <code>com.azure.spring</code>. Artifact ids
for the modern Spring Cloud Azure libraries have changed. And according to which Spring project it belongs, Spring Boot,
Spring Integration or Spring Cloud Stream, the artifact ids pattern could be <code>spring-cloud-azure-starter-[service]</code>
, <code>spring-integration-azure-[service]</code> and <code>spring-cloud-azure-stream-binder-[service]</code>. The legacy starters each has an
artifact id following the pattern <code>azure-spring-*</code>. This provides a quick and accessible means to help understand, at a
glance, whether you are using modern or legacy starters.</p>
</div>
<div class="paragraph">
<p>In the process of developing Spring Cloud Azure 4.0, we renamed some artifacts to make them follow the new naming
conventions, deleted some artifacts for its functionality could be put in a more appropriate artifact, and added some
new artifacts to better serve some scenarios.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy Artifact ID</th>
<th class="tableblock halign-left valign-top">Modern Artifact ID</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-boot-starter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This artifact has been deleted with all functionality be merged into the new <code>spring-cloud-azure-starter</code> artifact.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-boot-starter-active-directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-active-directory</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-boot-starter-active-directory-b2c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-active-directory-b2c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-boot-starter-cosmos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-data-cosmos</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-boot-starter-keyvault-certificates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">// TODO</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-boot-starter-keyvault-secrets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-keyvault-secrets</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-boot-starter-servicebus-jms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-servicebus-jms</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-boot-starter-storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-storage-blob &lt;br/&gt;spring-cloud-azure-starter-storage-file-share</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The legacy artifact contains the functionality of both Storage Blob and File Share, it&#8217;s been splited into two separate artifacts in 4.0, spring-cloud-azure-starter-storage-blob and spring-cloud-azure-starter-storage-file-share.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-boot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This artifact has been deleted with all functionality be merged into the new <code>spring-cloud-azure-autoconfigure</code> artifact.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-autoconfigure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This artifact has been deleted with all functionality be merged into the new <code>spring-cloud-azure-autoconfigure</code> artifact.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This artifact has been deleted with all functionality be merged into the new <code>spring-cloud-azure-autoconfigure</code> and <code>spring-cloud-azure-resourcemanager</code> artifacts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-messaging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">// TODO</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-starter-cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This artifact has been deleted, for using redis, just add spring-boot-starter-data-redis, spring-boot-starter-cache and spring-cloud-azure-starter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-starter-eventhubs-kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This artifact has been deleted, for using kafka, just add spring kafka and spring-cloud-azure-starter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-starter-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-integration-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Event Hubs Spring Integration client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-starter-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-integration-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Service Bus Spring Integration client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-starter-storage-queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-integration-storage-queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Storage Queue Spring Integration client library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This artifact has been deleted with all functionalities merged into the new <code>spring-cloud-azure-autoconfigure</code> artifact.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-stream-binder-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-stream-binder-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This artifact has been refactored using new redesign, mainly <code>spring-cloud-azure-stream-binder-eventhubs</code> and <code>spring-cloud-azure-stream-binder-eventhubs-core</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-stream-binder-eventhubs-core</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-stream-binder-service-core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-stream-binder-servicebus-core</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-stream-binder-servicebus-queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-stream-binder-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Service Bus Spring Cloud Stream Binder of both Queue and Topic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-cloud-stream-binder-servicebus-topic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-stream-binder-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Service Bus Spring Cloud Stream Binder of both Queue and Topic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-integration-core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-integration-azure-core</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-integration-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-integration-azure-eventhubs</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-integration-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-integration-azure-servicebus</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure-spring-integration-storage-queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-integration-azure-storage-queue</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-actuator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Azure Actuator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-actuator-autoconfigure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Azure Actuator AutoConfigure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-autoconfigure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Cloud Azure AutoConfigure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-core</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-resourcemanager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Core library using Azure Resource Manager to read metadata and create resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-service</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Core Spring Cloud Azure starter, including auto-configuration support.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-appconfiguration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure App Configuration Client library for Java.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Event Hubs Client library for Java.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Service Bus Client library for Java.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-storage-blob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Storage Blob Client library for Java.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-storage-file-share</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Storage File Share Client library for Java.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-storage-queue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Storage Queue Client library for Java.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-stream-eventhubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Event Hubs Spring Cloud Stream Binder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-stream-servicebus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Service Bus Spring Cloud Stream Binder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring-cloud-azure-starter-cosmos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starter for using Azure Cosmos Client library for Java</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="dependencies-changes"><a class="anchor" href="#dependencies-changes"></a><a class="link" href="#dependencies-changes">16.6. Dependencies changes</a></h3>
<div class="paragraph">
<p>Some unnecessary dependencies were included in the legacy artifacts, which we have removed in the modern Spring Cloud
Azure 4.0 libraries. Please make sure add the removed dependencies manually to your project to prevent unintentionally
crash.</p>
</div>
<div class="sect3">
<h4 id="spring-cloud-azure-starter"><a class="anchor" href="#spring-cloud-azure-starter"></a><a class="link" href="#spring-cloud-azure-starter">16.6.1. spring-cloud-azure-starter</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed dependencies</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.springframework.boot:spring-boot-starter-validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Please include the validation starter if you want to use the Hibernate Validator.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="spring-cloud-azure-starter-active-directory"><a class="anchor" href="#spring-cloud-azure-starter-active-directory"></a><a class="link" href="#spring-cloud-azure-starter-active-directory">16.6.2. spring-cloud-azure-starter-active-directory</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed dependencies</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.springframework.boot:spring-boot-starter-validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Please include the validation starter if you want to use the Hibernate Validator.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="spring-cloud-azure-starter-active-directory-b2c"><a class="anchor" href="#spring-cloud-azure-starter-active-directory-b2c"></a><a class="link" href="#spring-cloud-azure-starter-active-directory-b2c">16.6.3. spring-cloud-azure-starter-active-directory-b2c</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed dependencies</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.springframework.boot:spring-boot-starter-validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Please include the validation starter if you want to use the Hibernate Validator.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="authentication-2"><a class="anchor" href="#authentication-2"></a><a class="link" href="#authentication-2">16.7. Authentication</a></h3>
<div class="paragraph">
<p>Spring Cloud Azure 4.0 supports all the authentication methods each Azure Service SDK supports. It allows configuring a
global token credential as well as providing the token credential at each service level. But credential is not required
to configure in Spring Cloud Azure 4.0, it can leverage the credential stored in a local developing environment, or
managed identity in Azure Services, just make sure the principal has been granted sufficient permission to access the
target Azure resources.</p>
</div>
<div class="paragraph">
<p>A chained credential, the <a href="https://docs.microsoft.com/en-us/java/api/overview/azure/identity-readme?view=azure-java-stable#defaultazurecredential">DefaultAzureCredential</a> bean is auto-configured by default and will be used by all components if no more authentication information is specified.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Warning: There could be some <code>ERROR</code> logs be printed out while the <code>DefaultAzureCredential</code> running the chain and trying to find the first available credential. It doesn&#8217;t mean the <code>DefaultAzureCredential</code> is broken or unavailable. Meanwhile, we&#8217;ll keep improving this logging experience.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="configuration-properties-2"><a class="anchor" href="#configuration-properties-2"></a><a class="link" href="#configuration-properties-2">16.8. Configuration properties</a></h3>
<div class="sect3">
<h4 id="global-configurations"><a class="anchor" href="#global-configurations"></a><a class="link" href="#global-configurations">16.8.1. Global configurations</a></h4>
<div class="paragraph">
<p>The modern <code>spring-cloud-azure-starter</code> allows developers to define properties that apply to all Azure SDKs in the
namespace <code>spring.cloud.azure</code>. It was not supported in the legacy <code>azure-spring-boot-starter</code>. The global
configurations can be divided into five categories:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the transport clients underneath each Azure SDK.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.credential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure how to authenticate with Azure Active Directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the Azure cloud environment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the proxy options apply to all Azure SDK clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.retry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To configure the retry options apply to all Azure SDK clients.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Check <a href="https://github.com/Azure/azure-sdk-for-java/wiki/Spring-Cloud-Azure-4.0-Reference#a-configuration-properties">here</a> for a full list of configurations.</p>
</div>
</div>
<div class="sect3">
<h4 id="each-sdk-configurations"><a class="anchor" href="#each-sdk-configurations"></a><a class="link" href="#each-sdk-configurations">16.8.2. Each SDK configurations</a></h4>
<div class="sect4">
<h5 id="spring-cloud-azure-starter-integration-eventhubs"><a class="anchor" href="#spring-cloud-azure-starter-integration-eventhubs"></a><a class="link" href="#spring-cloud-azure-starter-integration-eventhubs">spring-cloud-azure-starter-integration-eventhubs</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(legacy: azure-spring-cloud-starter-eventhubs)
- As per prefix of <code>spring.cloud.azure.</code></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>prefix changed from
<code>spring.cloud.azure.eventhub.</code>
to
<code>spring.cloud.azure.eventhubs.</code></p>
</div>
<div class="paragraph">
<p>Changes for the child entries for this prefix, please refer the following tables:</p>
</div>
<div class="paragraph">
<p>| Legacy | Modern Spring Cloud Azure 4.0
 |:—|:—
|<code>checkpoint-storage-account</code>|<code>processor.checkpoint-store.account-name</code>
|<code>checkpoint-access-key</code>|<code>processor.checkpoint-store.account-key</code>
|<code>checkpoint-container</code>|<code>processor.checkpoint-store.container-name</code></p>
</div>
<div class="paragraph">
<p>For example, change from:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    azure:
      eventhub:
        connection-string: [eventhub-namespace-connection-string]
        checkpoint-storage-account: [checkpoint-storage-account]
        checkpoint-access-key: [checkpoint-access-key]
        checkpoint-container: [checkpoint-container]</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    azure:
      eventhubs:
        connection-string: [eventhub-namespace-connection-string]
        processor:
          checkpoint-store:
            container-name: [checkpoint-container]
            account-name: [checkpoint-storage-account]
            account-key: [checkpoint-access-key]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="spring-cloud-azure-stream-binder-eventhubs"><a class="anchor" href="#spring-cloud-azure-stream-binder-eventhubs"></a><a class="link" href="#spring-cloud-azure-stream-binder-eventhubs">spring-cloud-azure-stream-binder-eventhubs</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(legacy: azure-spring-cloud-stream-binder-eventhubs)
- As per prefix of <code>spring.cloud.azure.</code><br>
 <a href="#azure-spring-cloud-starter-eventhubs">please refer the above section</a></p>
</div>
</blockquote>
</div>
<div class="ulist">
<ul>
<li>
<p>As per prefix of <code>spring.cloud.stream.binders.&lt;eventhub-name&gt;.environment.spring.cloud.azure</code>:<br>
prefix change from:<br>
<code>spring.cloud.stream.binders.&lt;eventhub-name&gt;.environment.spring.cloud.azure.eventhub</code>
to:<br>
<code>spring.cloud.stream.binders.&lt;eventhub-name&gt;.environment.spring.cloud.azure.eventhubs</code></p>
</li>
<li>
<p>As per prefix of <code>spring.cloud.stream.eventhub</code>:<br>
prefix changed from<br>
<code>spring.cloud.stream.eventhub.bindings.&lt;binding-name&gt;.</code><br>
to<br>
<code>spring.cloud.stream.eventhubs.bindings.&lt;binding-name&gt;.</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Changes for the child entries for following prefix, please refer the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy</th>
<th class="tableblock halign-left valign-top">Modern Spring Cloud Azure 4.0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.max-batch-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.batch.max-size</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.max-wait-time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.batch.max-wait-time</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.checkpoint-mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.checkpoint.mode</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.checkpoint-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.checkpoint.count</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.checkpoint-interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>consumer.checkpoint.interval</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, you should change from:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    stream:
      eventhub:
        bindings:
            &lt;binding-name&gt;:
                consumer:
                  max-batch-size: [max-batch-size]
                  max-wait-time: [max-wait-time]
                  checkpoint-mode: [check-point-mode]
                  checkpoint-count: [checkpoint-count]
                  checkpoint-interval: [checkpoint-interval]</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  cloud:
    stream:
      eventhubs:
        bindings:
            &lt;binding-name&gt;:
                consumer:
                  batch:
                    max-size: [max-batch-size]
                    max-wait-time: [max-wait-time]
                  checkpoint:
                    mode: [check-point-mode]
                    count: [checkpoint-count]
                    interval: [checkpoint-interval]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="spring-cloud-azure-starter-integration-servicebus"><a class="anchor" href="#spring-cloud-azure-starter-integration-servicebus"></a><a class="link" href="#spring-cloud-azure-starter-integration-servicebus">spring-cloud-azure-starter-integration-servicebus</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(legacy: azure-spring-cloud-starter-servicebus)
For all configuration options supported in spring-cloud-azure-starter-integration-servicebus &amp; spring-integration-azure-servicebus libraries,
the prefix remains to be as <code>spring.cloud.azure.servicebus.</code>.</p>
</div>
</blockquote>
</div>
<div class="ulist">
<ul>
<li>
<p>Renamed configuration options[cols="&lt;,&lt;,&lt;"]</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy configuration suffix value</th>
<th class="tableblock halign-left valign-top">Current configuration suffix value</th>
<th class="tableblock halign-left valign-top">Current type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>transport-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client.transport-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AmqpTransportType</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry-options.max-retries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry.max-attempts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry-options.delay</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry.delay</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry-options.max-delay</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry.max-delay</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry-options.try-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry.timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry-options.retry-mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dropped, will be configured according to <code>retry.backoff.multiplier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="spring-cloud-azure-starter-active-directory-2"><a class="anchor" href="#spring-cloud-azure-starter-active-directory-2"></a><a class="link" href="#spring-cloud-azure-starter-active-directory-2">spring-cloud-azure-starter-active-directory</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All configuration property names changed the prefix from <code>azure.activedirectory.</code> to <code>spring.cloud.azure.active-directory.</code>.</p>
</li>
<li>
<p>New property <code>spring.cloud.azure.active-directory.enabled=true</code> is necessary to enable related features.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="spring-cloud-azure-starter-active-directory-b2c-2"><a class="anchor" href="#spring-cloud-azure-starter-active-directory-b2c-2"></a><a class="link" href="#spring-cloud-azure-starter-active-directory-b2c-2">spring-cloud-azure-starter-active-directory.b2c</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All configuration property names changed the prefix from <code>azure.activedirectory.b2c.</code> to <code>spring.cloud.azure.active-directory.b2c.</code>.</p>
</li>
<li>
<p>New property <code>spring.cloud.azure.active-directory.b2c.enabled=true</code> is necessary to enable related features.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="from-azure-spring-boot-starter-cosmos-to-spring-cloud-azure-starter-data-cosmos"><a class="anchor" href="#from-azure-spring-boot-starter-cosmos-to-spring-cloud-azure-starter-data-cosmos"></a><a class="link" href="#from-azure-spring-boot-starter-cosmos-to-spring-cloud-azure-starter-data-cosmos">From <code>azure-spring-boot-starter-cosmos</code> to <code>spring-cloud-azure-starter-data-cosmos</code></a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All configuration property names changed the prefix from <code>azure.cosmos</code> to <code>spring.cloud.azure.cosmos</code>.|===
|Legacy properties |Morden properties</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>|azure.cosmos.uri |spring.cloud.azure.cosmos.endpoint
|azure.cosmos.key |spring.cloud.azure.cosmos.key
|azure.cosmos.database |spring.cloud.azure.cosmos.database
|azure.cosmos.populateQueryMetrics |spring.cloud.azure.cosmos.populateQueryMetrics</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">===== From <strong>azure-spring-boot-starter-storage</strong> to <strong>spring-cloud-azure-starter-storage-blob</strong></p>
<p class="tableblock">. All configuration property names changed the prefix from <code>azure.storage</code> to <code>spring.cloud.azure.storage.blob</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">===</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Morden properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure.storage.account-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.blob.account-name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure.storage.account-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.blob.account-key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure.storage.blob-endpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.blob.endpoint</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="from-azure-spring-boot-starter-storage-to-spring-cloud-azure-starter-storage-file-share"><a class="anchor" href="#from-azure-spring-boot-starter-storage-to-spring-cloud-azure-starter-storage-file-share"></a><a class="link" href="#from-azure-spring-boot-starter-storage-to-spring-cloud-azure-starter-storage-file-share">From <strong>azure-spring-boot-starter-storage</strong> to <strong>spring-cloud-azure-starter-storage-file-share</strong></a></h5>
<div class="paragraph">
<p>All configuration property names changed the prefix from <code>azure.storage</code> to <code>spring.cloud.azure.storage.fileshare</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy properties</th>
<th class="tableblock halign-left valign-top">Morden properties</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure.storage.account-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.fileshare.account-name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure.storage.account-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.fileshare.account-key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">azure.storage.file-endpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.fileshare.endpoint</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="from-azure-spring-cloud-starter-storage-queue-to-spring-cloud-azure-starter-integration-storage-queue"><a class="anchor" href="#from-azure-spring-cloud-starter-storage-queue-to-spring-cloud-azure-starter-integration-storage-queue"></a><a class="link" href="#from-azure-spring-cloud-starter-storage-queue-to-spring-cloud-azure-starter-integration-storage-queue">From <strong>azure-spring-cloud-starter-storage-queue</strong> to <strong>spring-cloud-azure-starter-integration-storage-queue</strong></a></h5>
<div class="paragraph">
<p>All configuration property names changed the prefix from <code>spring.cloud.azure.storage</code> to <code>spring.cloud.azure.storage.queue</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy properties</th>
<th class="tableblock halign-left valign-top">Morden properties</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.queue.account-name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.access-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.queue.account-key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.resource-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.azure.storage.queue.resource.resource-group</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="spring-cloud-azure-stream-binder-servicebus"><a class="anchor" href="#spring-cloud-azure-stream-binder-servicebus"></a><a class="link" href="#spring-cloud-azure-stream-binder-servicebus">spring-cloud-azure-stream-binder-servicebus</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(legacy: azure-spring-cloud-stream-binder-servicebus-queue,azure-spring-cloud-stream-binder-servicebus-topic)</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>We have merged these two libraries into one, which supports both topic and queue.And the binder type is combined as <code>servicebus</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New configuration properties[cols="&lt;,&lt;"]</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Modern Spring Cloud Azure 4.0</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.stream.servicebus.bindings.{channel}.producer.entity-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>If you use the sending function, you need to set the entity-type, which can be set to topic or queue.</code></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Properties Configuration Changed[cols="&lt;,&lt;"]</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy</th>
<th class="tableblock halign-left valign-top">Modern Spring Cloud Azure 4.0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.stream.servicebus.queue.bindings.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.stream.servicebus.bindings.*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.stream.servicebus.topic.bindings.*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spring.cloud.stream.servicebus.bindings.*</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>please note: the binder type is renamed from: servicebus-queue/servicebus-topic to <code>servicebus</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use the Spring Cloud Stream binder for Azure Service Bus queue/topic，now your properties configuration should be changed to:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  cloud:
    azure:
      servicebus:
        connection-string: [servicebus-namespace-connection-string]
    stream:
      function:
        definition: consume;supply
      bindings:
        consume-in-0:
          destination: [servicebus-queue-name]
        supply-out-0:
          destination: [servicebus-queue-name-same-as-above]
      servicebus:
        bindings:
          consume-in-0:
            consumer:
              checkpoint-mode: MANUAL
          supply-out-0:
            producer:
              entity-type: queue#topic</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use the Spring Cloud Stream Binder for multiple Azure Service Bus namespaces,now your properties configuration should be changed to:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  cloud:
    stream:
      function:
        definition: queueConsume;queueSupply;topicConsume;topicSupply;
      bindings:
        topicConsume-in-0:
          destination: [ servicebus-topic-1-name ]
          group: [ topic-subscription-name ]
        topicSupply-out-0:
          destination: [ servicebus-topic-1-name ]
        queueConsume-in-0:
          binder: servicebus-2
          destination: [ servicebus-queue-1-name ]
        queueSupply-out-0:
          binder: servicebus-2
          destination: [ servicebus-queue-1-name ]
      binders:
        servicebus-1:
          type: servicebus
          default-candidate: true
          environment:
            spring:
              cloud:
                azure:
                  servicebus:
                    connection-string: [ servicebus-namespace-1-connection-string ]
        servicebus-2:
          type: servicebus
          default-candidate: false
          environment:
            spring:
              cloud:
                azure:
                  servicebus:
                    connection-string: [ servicebus-namespace-2-connection-string ]
      servicebus:
        bindings:
          topicSupply-out-0:
            producer:
              entity-type: topic
          queueSupply-out-0:
            producer:
              entity-type: queue
      poller:
        initial-delay: 0
        fixed-delay: 1000</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="api-breaking-changes"><a class="anchor" href="#api-breaking-changes"></a><a class="link" href="#api-breaking-changes">16.9. API breaking changes</a></h3>
<div class="sect3">
<h4 id="spring-cloud-azure-starter-integration-eventhubslegacy-azure-spring-cloud-starter-eventhubs-spring-cloud-azure-stream-binder-eventhubslegacy-azure-spring-cloud-stream-binder-eventhubs"><a class="anchor" href="#spring-cloud-azure-starter-integration-eventhubslegacy-azure-spring-cloud-starter-eventhubs-spring-cloud-azure-stream-binder-eventhubslegacy-azure-spring-cloud-stream-binder-eventhubs"></a><a class="link" href="#spring-cloud-azure-starter-integration-eventhubslegacy-azure-spring-cloud-starter-eventhubs-spring-cloud-azure-stream-binder-eventhubslegacy-azure-spring-cloud-stream-binder-eventhubs">16.9.1. <code>spring-cloud-azure-starter-integration-eventhubs(legacy: azure-spring-cloud-starter-eventhubs)</code> &amp; <code>spring-cloud-azure-stream-binder-eventhubs(legacy: azure-spring-cloud-stream-binder-eventhubs)</code></a></h4>
<div class="ulist">
<ul>
<li>
<p>Drop <code>EventHubOperation</code>, with its functionalities divided into <code>EventHubsTemplate</code> and <code>EventHubsProcessorContainer</code>.</p>
</li>
<li>
<p>Drop <code>EventHubsInboundChannelAdapter</code> and use new named <code>EventHubsInboundChannelAdapter</code>, also changed its
constructor signature.</p>
</li>
<li>
<p>Change <code>CheckpointConfig</code> instantiation style to simple constructor instead of build style.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>EventHubsInboundChannelAdapter usage for eventhubs integration:<br>
Legacy code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Bean
    public EventHubInboundChannelAdapter messageChannelAdapter(
        @Qualifier(INPUT_CHANNEL) MessageChannel inputChannel, EventHubOperation eventhubOperation) {
        eventhubOperation.setCheckpointConfig(CheckpointConfig.builder().checkpointMode(CheckpointMode.MANUAL).build());
        EventHubInboundChannelAdapter adapter = new EventHubInboundChannelAdapter(EVENTHUB_NAME,
            eventhubOperation, CONSUMER_GROUP);
        adapter.setOutputChannel(inputChannel);
        return adapter;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modern code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Bean
    public EventHubsInboundChannelAdapter messageChannelAdapter(
        @Qualifier(INPUT_CHANNEL) MessageChannel inputChannel,
        EventHubsProcessorContainer processorContainer) {
        CheckpointConfig config = new CheckpointConfig(CheckpointMode.MANUAL);

        EventHubsInboundChannelAdapter adapter =
                new EventHubsInboundChannelAdapter(processorContainer, EVENTHUB_NAME,
              CONSUMER_GROUP, config);
        adapter.setOutputChannel(inputChannel);
        return adapter;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And also EventHubOperation usage:</p>
</div>
<div class="paragraph">
<p>Legacy code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"> @Bean
    @ServiceActivator(inputChannel = OUTPUT_CHANNEL)
    public MessageHandler messageSender(EventHubOperation queueOperation) {
        DefaultMessageHandler handler = new DefaultMessageHandler(EVENTHUB_NAME, queueOperation);
        handler.setSendCallback(new ListenableFutureCallback&lt;Void&gt;() {
            @Override
            public void onSuccess(Void result) {
                LOGGER.info("Message was sent successfully.");
            }

            @Override
            public void onFailure(Throwable ex) {
                LOGGER.error("There was an error sending the message.", ex);
            }
        });

        return handler;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modern code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Bean
    @ServiceActivator(inputChannel = OUTPUT_CHANNEL)
    public MessageHandler messageSender(EventHubsTemplate queueOperation) {
        DefaultMessageHandler handler = new DefaultMessageHandler(EVENTHUB_NAME, queueOperation);
        handler.setSendCallback(new ListenableFutureCallback&lt;Void&gt;() {
            @Override
            public void onSuccess(Void result) {
                LOGGER.info("Message was sent successfully.");
            }

            @Override
            public void onFailure(Throwable ex) {
                LOGGER.error("There was an error sending the message.", ex);
            }
        });

        return handler;
    }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Package path changes:</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy class</th>
<th class="tableblock halign-left valign-top">Modern class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.EventHubsHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.eventhubs.support.EventHubsHeaders</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.AzureHeaders.CHECKPOINTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.messaging.AzureHeaders.CHECKPOINTER</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.api.reactor.Checkpointer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.messaging.checkpoint.Checkpointer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.api.CheckpointConfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.messaging.checkpoint.CheckpointConfig</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.api.CheckpointMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.messaging.checkpoint.CheckpointMode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.api.reactor.DefaultMessageHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.handler.DefaultMessageHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.eventhub.inbound.EventHubInboundChannelAdapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.eventhubs.inbound.EventHubsInboundChannelAdapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.eventhub.api.EventHubOperation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.eventhubs.core.EventHubsTemplate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.eventhubs.core.EventHubsProcessorContainer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="spring-cloud-azure-stream-binder-servicebus-2"><a class="anchor" href="#spring-cloud-azure-stream-binder-servicebus-2"></a><a class="link" href="#spring-cloud-azure-stream-binder-servicebus-2">16.9.2. spring-cloud-azure-stream-binder-servicebus</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy class</th>
<th class="tableblock halign-left valign-top">Modern class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.api.Checkpointer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.messaging.checkpoint.Checkpointer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.AzureHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.messaging.AzureHeaders</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.converter.ServiceBusMessageHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.servicebus.support.ServiceBusMessageHeaders</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="spring-cloud-azure-starter-integration-servicebus-2"><a class="anchor" href="#spring-cloud-azure-starter-integration-servicebus-2"></a><a class="link" href="#spring-cloud-azure-starter-integration-servicebus-2">16.9.3. spring-cloud-azure-starter-integration-servicebus</a></h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(legacy: azure-spring-cloud-starter-servicebus)
 - Combine the original <code>ServiceBusQueueTemplate#sendAsync</code> and <code>ServiceBusTopicTemplate#sendAsync</code> as <code>ServiceBusTemplate#sendAsync</code>
 and drop class of <code>ServiceBusQueueTemplate</code> and <code>ServiceBusTopicTemplate</code>.
 - Drop RxJava and CompletableFuture support of <code>ServiceBusTemplate</code> and support Reactor instead.
 - Drop interface of <code>ServiceBusQueueOperation</code> and <code>ServiceBusTopicOperation</code>.
 - Drop API of <code>ServiceBusQueueOperation#abandon</code> and <code>ServiceBusQueueOperation#deadletter</code>.
 - Combine the original <code>ServiceBusQueueTemplate#subscribe</code> and <code>ServiceBusTopicTemplate#subscribe</code> as <code>ServiceBusProcessorClient#subscribe</code>.
 - Deprecate the interface of <code>SubscribeOperation</code>.
 - Add new API of <code>setDefaultEntityType</code> for <code>ServiceBusTemplate</code>, the default entity type of a ServiceBusTemplate is required when no bean of <code>PropertiesSupplier&lt;String, ProducerProperties&gt;</code> is provided
for the <code>ProducerProperties#entityType</code>.
 - Drop class of <code>ServiceBusQueueInboundChannelAdapter</code> and <code>ServiceBusTopicInboundChannelAdapter</code> and combine them as <code>ServiceBusInboundChannelAdapter</code>.
 - Package path changes:</p>
</div>
</blockquote>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy class</th>
<th class="tableblock halign-left valign-top">Modern class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.DefaultMessageHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.handler.DefaultMessageHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.ServiceBusTemplate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.servicebus.core.ServiceBusTemplate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.inbound.ServiceBusQueueInboundChannelAdapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.inbound.ServiceBusInboundChannelAdapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.inbound.ServiceBusTopicInboundChannelAdapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.servicebus.inbound.ServiceBusInboundChannelAdapter</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Legacy code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Bean
    public ServiceBusQueueInboundChannelAdapter queueMessageChannelAdapter(
        @Qualifier("INPUT_CHANNEL_NAME") MessageChannel inputChannel, ServiceBusQueueOperation queueOperation) {
        queueOperation.setCheckpointConfig(CheckpointConfig.builder().checkpointMode(CheckpointMode.MANUAL).build());
        ServiceBusQueueInboundChannelAdapter adapter = new ServiceBusQueueInboundChannelAdapter("QUEUE_NAME",
            queueOperation);
        adapter.setOutputChannel(inputChannel);
        return adapter;
    }

    @Bean
    public ServiceBusTopicInboundChannelAdapter topicMessageChannelAdapter(
        @Qualifier("INPUT_CHANNEL_NAME") MessageChannel inputChannel, ServiceBusTopicOperation topicOperation) {
        topicOperation.setCheckpointConfig(CheckpointConfig.builder().checkpointMode(CheckpointMode.MANUAL).build());
        ServiceBusTopicInboundChannelAdapter adapter = new ServiceBusTopicInboundChannelAdapter("TOPIC_NAME",
            topicOperation, "SUBSCRIPTION_NAME");
        adapter.setOutputChannel(inputChannel);
        return adapter;
    }

    @Bean
    @ServiceActivator(inputChannel = "OUTPUT_CHANNEL_NAME")
    public MessageHandler queueMessageSender(ServiceBusQueueOperation queueOperation) {
        DefaultMessageHandler handler = new DefaultMessageHandler("QUEUE_NAME", queueOperation);
        handler.setSendCallback(new ListenableFutureCallback&lt;Void&gt;() {
            @Override
            public void onSuccess(Void result) {
                LOGGER.info("Message was sent successfully.");
            }
            @Override
            public void onFailure(Throwable ex) {
                LOGGER.info("There was an error sending the message.");
            }
        });
        return handler;
    }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Modern code:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    public ServiceBusInboundChannelAdapter queueMessageChannelAdapter(
        @Qualifier("INPUT_CHANNEL_NAME") MessageChannel inputChannel, ServiceBusProcessorContainer processorContainer) {
        ServiceBusInboundChannelAdapter adapter = new ServiceBusInboundChannelAdapter(processorContainer, "QUEUE_NAME",
            new CheckpointConfig(CheckpointMode.MANUAL));
        adapter.setOutputChannel(inputChannel);
        return adapter;
    }

    @Bean
    @ServiceActivator(inputChannel = "OUTPUT_CHANNEL_NAME")
    public MessageHandler queueMessageSender(ServiceBusTemplate serviceBusTemplate) {
        serviceBusTemplate.setDefaultEntityType(ServiceBusEntityType.QUEUE);
        DefaultMessageHandler handler = new DefaultMessageHandler("QUEUE_NAME", serviceBusTemplate);
        handler.setSendCallback(new ListenableFutureCallback&lt;Void&gt;() {
            @Override
            public void onSuccess(Void result) {
                LOGGER.info("Message was sent successfully for {}.", "QUEUE_NAME);
            }

            @Override
            public void onFailure(Throwable ex) {
                LOGGER.info("There was an error sending the message.");
            }
        });

        return handler;
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="spring-cloud-azure-starter-active-directory-3"><a class="anchor" href="#spring-cloud-azure-starter-active-directory-3"></a><a class="link" href="#spring-cloud-azure-starter-active-directory-3">16.9.4. spring-cloud-azure-starter-active-directory</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy class</th>
<th class="tableblock halign-left valign-top">Modern class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.aad.webapi.AADResourceServerWebSecurityConfigurerAdapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.cloud.autoconfigure.aad.webapi.AADResourceServerWebSecurityConfigurerAdapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.aad.webapp.AADWebSecurityConfigurerAdapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.cloud.autoconfigure.aad.webapp.AADWebSecurityConfigurerAdapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.autoconfigure.aad.AADAppRoleStatelessAuthenticationFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.cloud.autoconfigure.aad.filter.AADAppRoleStatelessAuthenticationFilter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.autoconfigure.aad.AADAuthenticationFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.cloud.autoconfigure.aad.filter.AADAuthenticationFilter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.autoconfigure.aad.AADAuthenticationProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.cloud.autoconfigure.aad.properties.AADAuthenticationProperties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.autoconfigure.aad.Membership</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.cloud.autoconfigure.aad.graph.Membership</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.autoconfigure.aad.UserPrincipal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.cloud.autoconfigure.aad.filter.UserPrincipal</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="spring-cloud-azure-starter-active-directory-b2c-3"><a class="anchor" href="#spring-cloud-azure-starter-active-directory-b2c-3"></a><a class="link" href="#spring-cloud-azure-starter-active-directory-b2c-3">16.9.5. spring-cloud-azure-starter-active-directory-b2c</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy class</th>
<th class="tableblock halign-left valign-top">Modern class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.autoconfigure.b2c.AADB2CJwtBearerTokenAuthenticationConverter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.cloud.autoconfigure.aad.b2c.AADB2CJwtBearerTokenAuthenticationConverter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.autoconfigure.b2c.AADB2COidcLoginConfigurer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.cloud.autoconfigure.aad.b2c.AADB2COidcLoginConfigurer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="spring-cloud-azure-starter-integration-storage-queue"><a class="anchor" href="#spring-cloud-azure-starter-integration-storage-queue"></a><a class="link" href="#spring-cloud-azure-starter-integration-storage-queue">16.9.6. spring-cloud-azure-starter-integration-storage-queue</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Legacy class</th>
<th class="tableblock halign-left valign-top">Modern class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.api.CheckpointMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.messaging.checkpoint.CheckpointMode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.api.reactor.Checkpointer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.messaging.checkpoint.Checkpointer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.api.reactor.DefaultMessageHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.handler.DefaultMessageHandler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.core.AzureHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.messaging.AzureHeaders</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.integration.storage.queue.StorageQueueOperation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.azure.spring.storage.queue.core.StorageQueueOperation</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="known-issues"><a class="anchor" href="#known-issues"></a><a class="link" href="#known-issues">17. Known Issues</a></h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>scary Identity error log</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="js/toc.js"></script>
</body>
</html>